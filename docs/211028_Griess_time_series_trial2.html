<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="KiseokUchicago" />

<meta name="date" content="2021-11-05" />

<title>211028_Griess_time_series_trial2</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Denit_visualization_R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/KiseokUchicago/Denit_visualization_R">
    <span class="fa fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">211028_Griess_time_series_trial2</h1>
<h4 class="author">KiseokUchicago</h4>
<h4 class="date">2021-11-05</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2021-11-29
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>Denit_visualization_R/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20210924code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20210924)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20210924code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20210924)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomKiseokUchicagoDenitvisualizationRtree8bde5098cdac4c028ec528ffb42c4f8f3f7175d9targetblank8bde509a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/KiseokUchicago/Denit_visualization_R/tree/8bde5098cdac4c028ec528ffb42c4f8f3f7175d9" target="_blank">8bde509</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomKiseokUchicagoDenitvisualizationRtree8bde5098cdac4c028ec528ffb42c4f8f3f7175d9targetblank8bde509a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/KiseokUchicago/Denit_visualization_R/tree/8bde5098cdac4c028ec528ffb42c4f8f3f7175d9" target="_blank">8bde509</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    Figure_211014_external_lab/

Untracked files:
    Untracked:  210928_pH.pdf
    Untracked:  211014_TN.pdf
    Untracked:  211014_drying_oven_TOC.pdf
    Untracked:  211014_toc_lab.pdf
    Untracked:  211020_df_full_innate.xlsx
    Untracked:  Figure_210911_TOC/
    Untracked:  Figure_210924/
    Untracked:  Figure_210927_TOC/
    Untracked:  Figure_210929/
    Untracked:  Figure_211006/
    Untracked:  Figure_211007/
    Untracked:  Figure_211008/
    Untracked:  Figure_211013/
    Untracked:  data/210911_TOC_sample_plate1.xlsx
    Untracked:  data/210922_Griess_sample_plate1-investigating.xlsx
    Untracked:  data/210922_Griess_sample_plate1.xlsx
    Untracked:  data/210927_TOC_sample_plate1_100ul.xlsx
    Untracked:  data/210927_TOC_sample_plate1_10ul.xlsx
    Untracked:  data/210928_Griess_sample_plate1.xlsx
    Untracked:  data/211005_Griess_sample_plate1.xlsx
    Untracked:  data/211007_Griess_blank_plate1.xlsx
    Untracked:  data/211007_Griess_blank_plate2.xlsx
    Untracked:  data/211008_Griess_blank_plate0.xlsx
    Untracked:  data/211008_Griess_blank_plate1.xlsx
    Untracked:  data/211017_Griess_plate0.xlsx
    Untracked:  data/211017_Griess_plate1.xlsx
    Untracked:  data/211017_Griess_plate2.xlsx
    Untracked:  data/211017_Griess_plate3.xlsx
    Untracked:  data/211017_Griess_plate4.xlsx
    Untracked:  data/211017_Griess_plate5.xlsx
    Untracked:  data/211017_Griess_plate6.xlsx
    Untracked:  data/211017_Griess_plate7.xlsx
    Untracked:  data/211017_Griess_plate8.xlsx
    Untracked:  data/211019_Griess_plate1.xlsx
    Untracked:  data/211020_Griess_plate0.xlsx
    Untracked:  data/211020_Griess_plate1.xlsx
    Untracked:  data/211020_df_full_innate.xlsx
    Untracked:  data/211025_Griess_no3_fit_plate0.xlsx
    Untracked:  data/211025_Griess_no3_fit_plate1.xlsx
    Untracked:  data/211025_Griess_plate0.xlsx
    Untracked:  data/211025_Griess_plate1.xlsx
    Untracked:  data/211028_Griess_plate1.xlsx
    Untracked:  data/211028_Griess_plate1_no3_fit.xlsx
    Untracked:  data/211028_Griess_plate2.xlsx
    Untracked:  data/211028_Griess_plate2_no3_fit.xlsx
    Untracked:  data/211028_Griess_plate3.xlsx
    Untracked:  data/211028_Griess_plate3_no3_fit.xlsx
    Untracked:  data/211028_Griess_plate4.xlsx
    Untracked:  data/211028_Griess_plate4_no3_fit.xlsx
    Untracked:  data/211028_time_table.xlsx
    Untracked:  data/211127_Griess_SUP1.xlsx
    Untracked:  data/211127_Griess_SUP11.xlsx
    Untracked:  data/211127_Griess_SUP3.xlsx
    Untracked:  data/211127_Griess_SUP5.xlsx
    Untracked:  data/211127_Griess_SUP7.xlsx
    Untracked:  data/211127_Griess_SUP9.xlsx
    Untracked:  data/211127_Griess_plate0.xlsx
    Untracked:  data/211127_time_table.xlsx
    Untracked:  data/TOC_TN_measurement_2_labs_211014.xlsx
    Untracked:  data/dry_weight_curve(9.5.21).xlsx
    Untracked:  data/pH_data(11.17.21)-Midway_etc.xlsx
    Untracked:  data/pH_data(9.14.21).xlsx
    Untracked:  data/pH_data(9.28.21).xlsx
    Untracked:  data/~$211127_time_table.xlsx
    Untracked:  df_NO2NO3.xlsx

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/211028_Griess_time_series_trial2.Rmd</code>) and HTML (<code>docs/211028_Griess_time_series_trial2.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/KiseokUchicago/Denit_visualization_R/blob/8bde5098cdac4c028ec528ffb42c4f8f3f7175d9/analysis/211028_Griess_time_series_trial2.Rmd" target="_blank">8bde509</a>
</td>
<td>
KiseokUchicago
</td>
<td>
2021-11-29
</td>
<td>
wflow_publish(“analysis/211028_Griess_time_series_trial2.Rmd”)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/KiseokUchicago/Denit_visualization_R/5c7ef7f33047395b30a2d6283c9513bc467e5ee6/docs/211028_Griess_time_series_trial2.html" target="_blank">5c7ef7f</a>
</td>
<td>
KiseokUchicago
</td>
<td>
2021-11-29
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/KiseokUchicago/Denit_visualization_R/blob/65cca32991285adecf794a8b0d174313a86164bc/analysis/211028_Griess_time_series_trial2.Rmd" target="_blank">65cca32</a>
</td>
<td>
KiseokUchicago
</td>
<td>
2021-11-29
</td>
<td>
wflow_publish(“analysis/211028_Griess_time_series_trial2.Rmd”)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/KiseokUchicago/Denit_visualization_R/b7a27fc654b4a75964fd3897878bb918315fcb21/docs/211028_Griess_time_series_trial2.html" target="_blank">b7a27fc</a>
</td>
<td>
KiseokUchicago
</td>
<td>
2021-11-17
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/KiseokUchicago/Denit_visualization_R/blob/0e51c783b732718aa376c2a9f7965100e762a497/analysis/211028_Griess_time_series_trial2.Rmd" target="_blank">0e51c78</a>
</td>
<td>
KiseokUchicago
</td>
<td>
2021-11-17
</td>
<td>
wflow_publish("analysis/*.Rmd")
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/KiseokUchicago/Denit_visualization_R/a07efe36f88496d6be0433854b563c52d12a73f3/docs/211028_Griess_time_series_trial2.html" target="_blank">a07efe3</a>
</td>
<td>
KiseokUchicago
</td>
<td>
2021-11-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/KiseokUchicago/Denit_visualization_R/blob/924beb71fc7f3c0fd4b1e611aeb7306fd38316b9/analysis/211028_Griess_time_series_trial2.Rmd" target="_blank">924beb7</a>
</td>
<td>
KiseokUchicago
</td>
<td>
2021-11-05
</td>
<td>
wflow_publish("analysis/*.Rmd")
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="time-series-analysis-trial2-griess-assay" class="section level2">
<h2>Time series analysis trial2 (Griess assay)</h2>
<p>Researcher: <strong>Kiseok Lee</strong><br />
Experiment Date: 10/28/21<br />
Analysis Date: 11/5/21 Lab: <strong>Seppe Kuehn</strong></p>
<pre class="r"><code># libraries
library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(vegan)
library(tidyverse)
library(magrittr)
library(readxl)
library(reshape2)
library(gtools)
library(devtools)
library(openxlsx)
library(ape)
library(stringr)
library(tidyr)
library(ggrepel)
library(ggpubr)

## theme for ggplot
mytheme &lt;- theme_bw() + 
  theme(text = element_text(family=&quot;serif&quot;)) +
  theme(plot.title = element_text(size = 19,hjust = 0.5, family=&quot;serif&quot;)) + 
  theme(axis.title.x = element_text(size = 17,hjust = 0.5, family=&quot;serif&quot;)) + 
  theme(axis.title.y = element_text(size = 17,hjust = 0.5, family=&quot;serif&quot;)) + 
  theme(axis.text.x = element_text(hjust = 0.5, vjust=0.3,size=13, family=&quot;serif&quot;))+
  theme(axis.text.y = element_text(size=10, family=&quot;serif&quot;))+
  theme(panel.grid.major = element_blank()) +
  theme(panel.grid.minor = element_blank(),panel.background=element_blank(),panel.border=element_blank(),plot.background=element_blank()) +
  theme(axis.ticks = element_line(size = 1.1))

mytheme_2d &lt;- theme_bw() + 
  theme(text = element_text(family=&quot;serif&quot;)) +
  theme(plot.title = element_text(size = 19,hjust = 0.5, family=&quot;serif&quot;)) + 
  theme(axis.title.x = element_text(size = 17,hjust = 0.5, family=&quot;serif&quot;)) + 
  theme(axis.title.y = element_text(size = 17,hjust = 0.5, family=&quot;serif&quot;)) + 
  theme(axis.text.x = element_text(hjust = 0.5, vjust=0.3,size=13, family=&quot;serif&quot;))+
  theme(axis.text.y = element_text(size=13, family=&quot;serif&quot;))+
  # theme(panel.grid.major = element_blank()) +
  # theme(panel.grid.minor = element_blank(),panel.background=element_blank(),plot.background=element_blank()) +
  theme(axis.ticks = element_line(size = 1.1))


# color collection
my_color_collection &lt;- c(
  &quot;#CBD588&quot;, &quot;#5F7FC7&quot;, &quot;orange&quot;, &quot;#AD6F3B&quot;, &quot;#673770&quot;, 
  &quot;#D14285&quot;, &quot;#652926&quot;, &quot;#C84248&quot;, &quot;#8569D5&quot;, &quot;#5E738F&quot;,
  &quot;#D1A33D&quot;, &quot;#8A7C64&quot;, &quot;#599861&quot;,&quot;#616163&quot;, &quot;#FFCDB2&quot;,
  &quot;#6D9F71&quot;, &quot;#242F40&quot;,
  &quot;#CCA43B&quot;, &quot;#F92A82&quot;, &quot;#ED7B84&quot;, &quot;#7EB77F&quot;, 
  &quot;#DEC4A1&quot;, &quot;#E5D1D0&quot;, &#39;#0E8482&#39;, &#39;#C9DAEA&#39;, &#39;#337357&#39;, 
  &#39;#95C623&#39;, &#39;#E55812&#39;, &#39;#04471C&#39;, &#39;#F2D7EE&#39;, &#39;#D3BCC0&#39;, 
  &#39;#A5668B&#39;, &#39;#69306D&#39;, &#39;#0E103D&#39;, &#39;#1A535C&#39;, &#39;#4ECDC4&#39;, 
  &#39;#F7FFF7&#39;, &#39;#FF6B6B&#39;, &#39;#FFE66D&#39;, &#39;#6699CC&#39;, &#39;#FFF275&#39;, 
  &#39;#FF8C42&#39;, &#39;#FF3C38&#39;, &#39;#A23E48&#39;, &#39;#000000&#39;, &#39;#CF5C36&#39;, 
  &#39;#EEE5E9&#39;, &#39;#7C7C7C&#39;, &#39;#EFC88B&#39;, &#39;#2E5266&#39;, &#39;#6E8898&#39;, 
  &#39;#9FB1BC&#39;, &#39;#D3D0CB&#39;, &#39;#E2C044&#39;, &#39;#5BC0EB&#39;, &#39;#FDE74C&#39;, 
  &#39;#9BC53D&#39;, &#39;#E55934&#39;, &#39;#FA7921&#39;, &quot;#CD9BCD&quot;, &quot;#508578&quot;, &quot;#DA5724&quot;)

# for git push, use this instead of using wflow_git_push()
# git push -u origin master (in the Git app / in the working directory)</code></pre>
</div>
<div id="import-data-table-from-python-code" class="section level2">
<h2>1. Import data table from python code</h2>
<p>We are going to use the vcl3 treated standard curve that is fitted with pure nitrate standards</p>
<pre class="r"><code># import file
df_p1 &lt;- openxlsx::read.xlsx(&quot;data/211028_Griess_plate1_no3_fit.xlsx&quot;)
df_p2 &lt;- openxlsx::read.xlsx(&quot;data/211028_Griess_plate2_no3_fit.xlsx&quot;)
df_p3 &lt;- openxlsx::read.xlsx(&quot;data/211028_Griess_plate3_no3_fit.xlsx&quot;)
df_p4 &lt;- openxlsx::read.xlsx(&quot;data/211028_Griess_plate4_no3_fit.xlsx&quot;)


head(df_p1)</code></pre>
<pre><code>  Well                          Sample Extraction_method Extraction_ul
1  A01    Method_test_Soil_Nitrate_5mM         0.5_1_1.5           100
2  A02  Method_test_Soil_Nitrate_2.5mM         0.5_1_1.5           100
3  A03 Method_test_Soil_Nitrate_1.25mM         0.5_1_1.5           100
4  A04    Method_test_Soil_Nitrate_0mM         0.5_1_1.5           100
5  A05    Method_test_Soil_Nitrate_5mM         0.5_1_1.5           100
6  A06  Method_test_Soil_Nitrate_2.5mM         0.5_1_1.5           100
  Nitrate_input    Category Sample_type Sampling_method Time_point Plate
1          5.00 Method_test        Soil   filter-freeze         T0    P1
2          2.50 Method_test        Soil   filter-freeze         T0    P1
3          1.25 Method_test        Soil   filter-freeze         T0    P1
4          0.00 Method_test        Soil   filter-freeze         T0    P1
5          5.00 Method_test        Soil   freeze-filter         T0    P1
6          2.50 Method_test        Soil   freeze-filter         T0    P1
  NO2_OD540 NO2NO3_OD540      NO2_mM  NO2NO3_mM     NO3_mM
1   0.00465      1.90740 0.006110973 2.02792247 2.02181149
2   0.00510      1.06245 0.006323303 1.00341954 0.99709623
3   0.00380      0.58310 0.005709928 0.52052875 0.51481882
4   0.00270      0.02980 0.005190971 0.01861312 0.01342215
5   0.00425      1.64050 0.005922242 1.67217035 1.66624811
6   0.00420      1.04810 0.005898651 0.98816287 0.98226422</code></pre>
<pre class="r"><code>colnames(df_p1)</code></pre>
<pre><code> [1] &quot;Well&quot;              &quot;Sample&quot;            &quot;Extraction_method&quot;
 [4] &quot;Extraction_ul&quot;     &quot;Nitrate_input&quot;     &quot;Category&quot;         
 [7] &quot;Sample_type&quot;       &quot;Sampling_method&quot;   &quot;Time_point&quot;       
[10] &quot;Plate&quot;             &quot;NO2_OD540&quot;         &quot;NO2NO3_OD540&quot;     
[13] &quot;NO2_mM&quot;            &quot;NO2NO3_mM&quot;         &quot;NO3_mM&quot;           </code></pre>
<pre class="r"><code>dim(df_p1)</code></pre>
<pre><code>[1] 96 15</code></pre>
<pre class="r"><code>head(df_p2)</code></pre>
<pre><code>  Well                   Sample Extraction_method Extraction_ul Nitrate_input
1  A01    Anaerobic_5mM_Soil_T1         0.5_1_1.5            80          5.00
2  A02  Anaerobic_2.5mM_Soil_T1         0.5_1_1.5            80          2.50
3  A03 Anaerobic_1.25mM_Soil_T1         0.5_1_1.5            80          1.25
4  A04    Anaerobic_0mM_Soil_T1         0.5_1_1.5            80          0.00
5  A05      Aerobic_5mM_Soil_T1         0.5_1_1.5            80          5.00
6  A06    Aerobic_2.5mM_Soil_T1         0.5_1_1.5            80          2.50
   Category Sample_type Sampling_method Time_point Plate NO2_OD540 NO2NO3_OD540
1 Anaerobic        Soil   freeze-filter         T1    P2   0.00380      1.78870
2 Anaerobic        Soil   freeze-filter         T1    P2   0.00415      0.99450
3 Anaerobic        Soil   freeze-filter         T1    P2   0.00355      0.52835
4 Anaerobic        Soil   freeze-filter         T1    P2   0.00125      0.00955
5   Aerobic        Soil   freeze-filter         T1    P2   0.00500      1.69705
6   Aerobic        Soil   freeze-filter         T1    P2   0.00430      0.91090
       NO2_mM   NO2NO3_mM    NO3_mM
1 0.005709928 1.865042002 1.8593321
2 0.005875061 0.931656571 0.9257815
3 0.005591979 0.468497812 0.4629058
4 0.004506967 0.001159765 0.0000000
5 0.006276118 1.744502044 1.7382259
6 0.005945833 0.844981109 0.8390353</code></pre>
<pre class="r"><code>colnames(df_p2)</code></pre>
<pre><code> [1] &quot;Well&quot;              &quot;Sample&quot;            &quot;Extraction_method&quot;
 [4] &quot;Extraction_ul&quot;     &quot;Nitrate_input&quot;     &quot;Category&quot;         
 [7] &quot;Sample_type&quot;       &quot;Sampling_method&quot;   &quot;Time_point&quot;       
[10] &quot;Plate&quot;             &quot;NO2_OD540&quot;         &quot;NO2NO3_OD540&quot;     
[13] &quot;NO2_mM&quot;            &quot;NO2NO3_mM&quot;         &quot;NO3_mM&quot;           </code></pre>
<pre class="r"><code>dim(df_p2)</code></pre>
<pre><code>[1] 96 15</code></pre>
<pre class="r"><code>head(df_p3)</code></pre>
<pre><code>  Well                  Sample Extraction_method Extraction_ul Nitrate_input
1  A01     Aerobic_5mM_Soil_T2         0.5_1_1.5            80          5.00
2  A02   Aerobic_2.5mM_Soil_T2         0.5_1_1.5            80          2.50
3  A03  Aerobic_1.25mM_Soil_T2         0.5_1_1.5            80          1.25
4  A04     Aerobic_0mM_Soil_T2         0.5_1_1.5            80          0.00
5  A05   Anaerobic_5mM_Soil_T3         0.5_1_1.5            80          5.00
6  A06 Anaerobic_2.5mM_Soil_T3         0.5_1_1.5            80          2.50
   Category Sample_type Sampling_method Time_point Plate NO2_OD540 NO2NO3_OD540
1   Aerobic        Soil   freeze-filter         T2    P3   0.00065      1.64400
2   Aerobic        Soil   freeze-filter         T2    P3   0.00065      0.94210
3   Aerobic        Soil   freeze-filter         T2    P3   0.00030      0.50190
4   Aerobic        Soil   freeze-filter         T2    P3   0.00000      0.00000
5 Anaerobic        Soil   freeze-filter         T3    P3   0.00280      1.43745
6 Anaerobic        Soil   freeze-filter         T3    P3   0.00260      0.67170
       NO2_mM NO2NO3_mM    NO3_mM
1 0.004223955 1.6766042 1.6723803
2 0.004223955 0.8771264 0.8729025
3 0.004058872 0.4435646 0.4395057
4 0.003917376 0.0000000 0.0000000
5 0.005238147 1.4238037 1.4185656
6 0.005143796 0.6059721 0.6008283</code></pre>
<pre class="r"><code>colnames(df_p3)</code></pre>
<pre><code> [1] &quot;Well&quot;              &quot;Sample&quot;            &quot;Extraction_method&quot;
 [4] &quot;Extraction_ul&quot;     &quot;Nitrate_input&quot;     &quot;Category&quot;         
 [7] &quot;Sample_type&quot;       &quot;Sampling_method&quot;   &quot;Time_point&quot;       
[10] &quot;Plate&quot;             &quot;NO2_OD540&quot;         &quot;NO2NO3_OD540&quot;     
[13] &quot;NO2_mM&quot;            &quot;NO2NO3_mM&quot;         &quot;NO3_mM&quot;           </code></pre>
<pre class="r"><code>dim(df_p3)</code></pre>
<pre><code>[1] 96 15</code></pre>
<pre class="r"><code>head(df_p4)</code></pre>
<pre><code>  Well                   Sample Extraction_method Extraction_ul Nitrate_input
1  A01    Anaerobic_5mM_Soil_T4         0.5_1_1.5            80          5.00
2  A02  Anaerobic_2.5mM_Soil_T4         0.5_1_1.5            80          2.50
3  A03 Anaerobic_1.25mM_Soil_T4         0.5_1_1.5            80          1.25
4  A04    Anaerobic_0mM_Soil_T4         0.5_1_1.5            80          0.00
5  A05      Aerobic_5mM_Soil_T4         0.5_1_1.5            80          5.00
6  A06    Aerobic_2.5mM_Soil_T4         0.5_1_1.5            80          2.50
   Category Sample_type Sampling_method Time_point Plate NO2_OD540 NO2NO3_OD540
1 Anaerobic        Soil   freeze-filter         T4    P4   0.01155      1.32085
2 Anaerobic        Soil   freeze-filter         T4    P4   0.05780      0.33815
3 Anaerobic        Soil   freeze-filter         T4    P4   0.00455      0.00000
4 Anaerobic        Soil   freeze-filter         T4    P4   0.00360      0.00000
5   Aerobic        Soil   freeze-filter         T4    P4   0.00365      1.72045
6   Aerobic        Soil   freeze-filter         T4    P4   0.00570      0.95450
       NO2_mM NO2NO3_mM   NO3_mM
1 0.009367601 1.2882709 1.278903
2 0.031246445 0.2920134 0.260767
3 0.006063790 0.0000000 0.000000
4 0.005615568 0.0000000 0.000000
5 0.005639158 1.7748769 1.769238
6 0.006606423 0.8899684 0.883362</code></pre>
<pre class="r"><code>colnames(df_p4)</code></pre>
<pre><code> [1] &quot;Well&quot;              &quot;Sample&quot;            &quot;Extraction_method&quot;
 [4] &quot;Extraction_ul&quot;     &quot;Nitrate_input&quot;     &quot;Category&quot;         
 [7] &quot;Sample_type&quot;       &quot;Sampling_method&quot;   &quot;Time_point&quot;       
[10] &quot;Plate&quot;             &quot;NO2_OD540&quot;         &quot;NO2NO3_OD540&quot;     
[13] &quot;NO2_mM&quot;            &quot;NO2NO3_mM&quot;         &quot;NO3_mM&quot;           </code></pre>
<pre class="r"><code>dim(df_p4)</code></pre>
<pre><code>[1] 64 15</code></pre>
<pre class="r"><code># remove wells 
df_p2 %&lt;&gt;% filter(!(Well %in% c(&quot;D01&quot;,&quot;F01&quot;,&quot;D09&quot;,&quot;F09&quot;))) # blanks contaminated with soil
dim(df_p2)</code></pre>
<pre><code>[1] 92 15</code></pre>
<pre class="r"><code>df_p2 %&lt;&gt;% filter(!(Well %in% c(&quot;A10&quot;,&quot;A11&quot;))) # filter contamination
dim(df_p2)</code></pre>
<pre><code>[1] 90 15</code></pre>
<pre class="r"><code>df_p3 %&lt;&gt;% filter(!(Well %in% c(&quot;D05&quot;,&quot;F05&quot;))) # blanks contaminated with soil
dim(df_p3)</code></pre>
<pre><code>[1] 94 15</code></pre>
<pre class="r"><code>df_p4 %&lt;&gt;% filter(!(Well %in% c(&quot;D01&quot;,&quot;F01&quot;))) # blanks contaminated with soil
dim(df_p4)</code></pre>
<pre><code>[1] 62 15</code></pre>
<pre class="r"><code># bind two dataframe
df_p &lt;- rbind(df_p1, df_p2, df_p3, df_p4)
dim(df_p)</code></pre>
<pre><code>[1] 342  15</code></pre>
<pre class="r"><code># remove NA
dim(df_p)</code></pre>
<pre><code>[1] 342  15</code></pre>
<pre class="r"><code>df_p &lt;- na.omit(df_p)
dim(df_p)</code></pre>
<pre><code>[1] 342  15</code></pre>
<pre class="r"><code># multiply dilution factor which is 5/2
df_p %&lt;&gt;% select(-NO2_OD540, -NO2NO3_OD540)
df_p %&lt;&gt;% mutate(NO2_mM = NO2_mM * (5/2), NO2NO3_mM = NO2NO3_mM * (5/2), NO3_mM = NO3_mM * (5/2))

# remove 4mM spike ins because it is out of standard curve range

# Check
# df_p1 %&gt;% filter(Well ==&quot;B02&quot;)
# df_p1 %&gt;% filter(Well ==&quot;H04&quot;)</code></pre>
</div>
<div id="get-average-and-standard-deviation" class="section level2">
<h2>2. Get average and standard deviation</h2>
<pre class="r"><code># average and standard deviation

# plot to see
ggplot(df_p, aes(x=Nitrate_input, y=NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Without averaging \n&quot;) +
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-3-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># plot to see
ggplot(df_p1, aes(x=Nitrate_input, y=NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Without averaging \n&quot;) +
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-3-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># plot to see
ggplot(df_p2, aes(x=Nitrate_input, y=NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Without averaging \n&quot;) +
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-3-3.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># average technical replicate
df_NO2NO3 &lt;- df_p %&gt;% group_by(Sample, Nitrate_input, Category, Sample_type, Sampling_method, Time_point, Plate) %&gt;% summarise(Ave_NO2_mM = mean(NO2_mM), Std_NO2_mM = sd(NO2_mM), Ave_NO3_mM = mean(NO3_mM), Std_NO3_mM = sd(NO3_mM)) %&gt;% ungroup()

dim(df_NO2NO3)</code></pre>
<pre><code>[1] 88 11</code></pre>
<pre class="r"><code>dim(df_p)</code></pre>
<pre><code>[1] 342  13</code></pre>
<pre class="r"><code>df_NO2NO3$Sample_type</code></pre>
<pre><code> [1] &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot; 
[10] &quot;Soil&quot;  &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot; 
[19] &quot;Soil&quot;  &quot;Soil&quot;  &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot;  &quot;Soil&quot; 
[28] &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot; 
[37] &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot; 
[46] &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot;  &quot;Soil&quot; 
[55] &quot;Soil&quot;  &quot;Soil&quot;  &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot; 
[64] &quot;Soil&quot;  &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot; 
[73] &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Blank&quot; &quot;Soil&quot; 
[82] &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot;  &quot;Soil&quot; </code></pre>
<pre class="r"><code># Factor in orders
df_NO2NO3$Sample_type &lt;-  factor(df_NO2NO3$Sample_type, levels = c(&quot;Soil&quot;,&quot;Blank&quot;))

# Testing negative samples
df_neg &lt;- df_NO2NO3 %&gt;% filter(Sample_type == &quot;Blank&quot;, Nitrate_input == 0)
df_neg</code></pre>
<pre><code># A tibble: 11 x 11
   Sample    Nitrate_input Category Sample_type Sampling_method Time_point Plate
   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
 1 Aerobic_~             0 Aerobic  Blank       freeze-filter   T0         P1   
 2 Aerobic_~             0 Aerobic  Blank       freeze-filter   T1         P2   
 3 Aerobic_~             0 Aerobic  Blank       freeze-filter   T2         P3   
 4 Aerobic_~             0 Aerobic  Blank       freeze-filter   T3         P3   
 5 Aerobic_~             0 Aerobic  Blank       freeze-filter   T4         P4   
 6 Anaerobi~             0 Anaerob~ Blank       freeze-filter   T1         P2   
 7 Anaerobi~             0 Anaerob~ Blank       freeze-filter   T2         P2   
 8 Anaerobi~             0 Anaerob~ Blank       freeze-filter   T3         P3   
 9 Anaerobi~             0 Anaerob~ Blank       freeze-filter   T4         P4   
10 Method_t~             0 Method_~ Blank       filter-freeze   T0         P1   
11 Method_t~             0 Method_~ Blank       freeze-filter   T0         P1   
# ... with 4 more variables: Ave_NO2_mM &lt;dbl&gt;, Std_NO2_mM &lt;dbl&gt;,
#   Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;</code></pre>
<pre class="r"><code># close to zero

# moisture correction factor
soil_spike_ratio = 0.5  # soil weight(0.75g) / spike in volume (1.5ml)
moisture_percent = 26.4
mcf = (soil_spike_ratio*(moisture_percent/100) + 1)
mcf</code></pre>
<pre><code>[1] 1.132</code></pre>
<pre class="r"><code># apply moisture factor only in Sample_type == &quot;soil&quot;
dim(df_NO2NO3)</code></pre>
<pre><code>[1] 88 11</code></pre>
<pre class="r"><code>df_NO2NO3_soil_mcf &lt;- df_NO2NO3 %&gt;% filter(Sample_type == &quot;Soil&quot;) %&gt;% mutate(Ave_NO3_mM = Ave_NO3_mM * mcf, Ave_NO2_mM = Ave_NO2_mM * mcf, Std_NO2_mM = Std_NO2_mM * mcf, Std_NO3_mM = Std_NO3_mM * mcf)
dim(df_NO2NO3_soil_mcf) #44</code></pre>
<pre><code>[1] 44 11</code></pre>
<pre class="r"><code>df_NO2NO3_blank_mcf &lt;- df_NO2NO3 %&gt;% filter(Sample_type == &quot;Blank&quot;) 
dim(df_NO2NO3_blank_mcf) #44</code></pre>
<pre><code>[1] 44 11</code></pre>
<pre class="r"><code>df_NO2NO3_mcf &lt;- rbind(df_NO2NO3_soil_mcf, df_NO2NO3_blank_mcf)
dim(df_NO2NO3_mcf)</code></pre>
<pre><code>[1] 88 11</code></pre>
<pre class="r"><code># Get the metadata for time point and left join
Time_table &lt;- openxlsx::read.xlsx(&quot;data/211028_time_table.xlsx&quot;)
Time_table %&lt;&gt;% select(-Date) 
dim(df_NO2NO3_mcf)</code></pre>
<pre><code>[1] 88 11</code></pre>
<pre class="r"><code>df_NO2NO3 &lt;- df_NO2NO3 %&gt;% left_join(Time_table, by=(&quot;Time_point&quot;=&quot;Time_point&quot;))
df_NO2NO3_mcf &lt;- df_NO2NO3_mcf %&gt;% left_join(Time_table, by=(&quot;Time_point&quot;=&quot;Time_point&quot;))
dim(df_NO2NO3_mcf)</code></pre>
<pre><code>[1] 88 13</code></pre>
<pre class="r"><code># plot to see
ggplot(df_NO2NO3, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;After averaging with technical replicates \n&quot;) +
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-3-4.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># average biological replicates
# standard deviation is the standard deviation of the technical replicate average
dim(df_NO2NO3)</code></pre>
<pre><code>[1] 88 13</code></pre>
<pre class="r"><code>head(df_NO2NO3)</code></pre>
<pre><code># A tibble: 6 x 13
  Sample     Nitrate_input Category Sample_type Sampling_method Time_point Plate
  &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
1 Aerobic_0~             0 Aerobic  Blank       freeze-filter   T0         P1   
2 Aerobic_0~             0 Aerobic  Blank       freeze-filter   T1         P2   
3 Aerobic_0~             0 Aerobic  Blank       freeze-filter   T2         P3   
4 Aerobic_0~             0 Aerobic  Blank       freeze-filter   T3         P3   
5 Aerobic_0~             0 Aerobic  Blank       freeze-filter   T4         P4   
6 Aerobic_0~             0 Aerobic  Soil        freeze-filter   T0         P1   
# ... with 6 more variables: Ave_NO2_mM &lt;dbl&gt;, Std_NO2_mM &lt;dbl&gt;,
#   Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;, Time_minutes &lt;chr&gt;, Time_hours &lt;dbl&gt;</code></pre>
</div>
<div id="sanity-check-moisture-correction-blank-correction-factor-dilution-correction" class="section level2">
<h2>3. Sanity check: moisture correction &amp; blank correction factor &amp; dilution correction</h2>
</div>
<div id="first-check-the-blanks" class="section level2">
<h2>3.1. First check the blanks</h2>
<pre class="r"><code># without any correction
# all blanks
df_blank &lt;- df_NO2NO3 %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Blank&quot;)
dim(df_blank)</code></pre>
<pre><code>[1] 12 13</code></pre>
<pre class="r"><code>ggplot(df_blank, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  # scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  # scale_x_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  ggtitle(&quot;Blank test \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-4-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># T0 sample
df_blank &lt;- df_NO2NO3 %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Blank&quot;, Category == &quot;Aerobic&quot;)
ggplot(df_blank, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  # scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  # scale_x_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  ggtitle(&quot;Blank test \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-4-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># only method test
df_blank &lt;- df_NO2NO3 %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Blank&quot;, Category == &quot;Method_test&quot;)

ggplot(df_blank, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sampling_method, group=Sampling_method)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,5.5,1), limits=c(0, 5.5))+
  scale_x_continuous(breaks = seq(0,5.5,1), limits=c(0, 5.5))+
  ggtitle(&quot;Blank test \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-4-3.png" width="1056" style="display: block; margin: auto;" /></p>
</div>
<div id="check-the-soil" class="section level2">
<h2>3.2. Check the soil</h2>
<pre class="r"><code># without any correction
# all soils
df_soil &lt;- df_NO2NO3 %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;)
dim(df_soil)</code></pre>
<pre><code>[1] 12 13</code></pre>
<pre class="r"><code>ggplot(df_soil, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  # scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  scale_x_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  ggtitle(&quot;Soil test \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-5-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># T0 sample
df_soil &lt;- df_NO2NO3 %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Aerobic&quot;)
ggplot(df_soil, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  # scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  scale_x_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  ggtitle(&quot;Soil test (t=0) \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-5-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># only method test
df_soil &lt;- df_NO2NO3 %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Method_test&quot;)

ggplot(df_soil, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sampling_method, group=Sampling_method)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  scale_x_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  ggtitle(&quot;Soil test \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-5-3.png" width="1056" style="display: block; margin: auto;" /></p>
</div>
<div id="moisture-correction-factor" class="section level2">
<h2>3.3. Moisture correction factor</h2>
<pre class="r"><code># moisture correction factor
soil_spike_ratio = 0.5  # soil weight(0.75g) / spike in volume (1.5ml)
moisture_percent = 26.4
mcf = (soil_spike_ratio*(moisture_percent/100) + 1)
mcf</code></pre>
<pre><code>[1] 1.132</code></pre>
<pre class="r"><code>df_NO2NO3_mcf &lt;- df_NO2NO3 %&gt;% mutate(Ave_NO3_mM = Ave_NO3_mM * mcf, Ave_NO2_mM = Ave_NO2_mM * mcf, Std_NO2_mM = Std_NO2_mM * mcf, Std_NO3_mM = Std_NO3_mM * mcf)

# T0 sample
df_soil &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Aerobic&quot;)
ggplot(df_soil, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  # scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  scale_x_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  ggtitle(&quot;Soil test (t=0) (after moisture correction) \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-6-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># only method test
df_soil &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Method_test&quot;)

ggplot(df_soil, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sampling_method, group=Sampling_method)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,6,1), limits=c(0, 6))+
  scale_x_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  ggtitle(&quot;Soil test (after moisture correction) \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-6-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># (correction) get extraction ratio
# innate nitrate
add_innate_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Sample_type== &quot;Soil&quot;, Nitrate_input == 0) %&gt;% rename(Innate_NO3_mM = Ave_NO3_mM) %&gt;% select(Category, Sample_type, Sampling_method, Time_point, Innate_NO3_mM)

dim(df_NO2NO3_mcf)</code></pre>
<pre><code>[1] 88 13</code></pre>
<pre class="r"><code>df_NO2NO3_innate_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Sample_type== &quot;Soil&quot;, Nitrate_input != 0) %&gt;% arrange(Sample) %&gt;%
  left_join(add_innate_mcf, by=c(&quot;Category&quot;=&quot;Category&quot;, &quot;Sample_type&quot;=&quot;Sample_type&quot;, &quot;Sampling_method&quot;=&quot;Sampling_method&quot;, &quot;Time_point&quot;=&quot;Time_point&quot;)) %&gt;% 
  mutate(Retrieved_NO3_mM_mcf = Ave_NO3_mM - Innate_NO3_mM)

# Retrieved ratio of spike ins
df_NO2NO3_innate_mcf$Ratio_retrieved_mcf &lt;- df_NO2NO3_innate_mcf$Retrieved_NO3_mM_mcf / df_NO2NO3_innate_mcf$Nitrate_input 
df_NO2NO3_innate_mcf$Std_Ratio_retrieved_mcf &lt;- df_NO2NO3_innate_mcf$Std_NO3_mM / df_NO2NO3_innate_mcf$Nitrate_input 

df_NO2NO3_innate_mcf</code></pre>
<pre><code># A tibble: 33 x 17
   Sample    Nitrate_input Category Sample_type Sampling_method Time_point Plate
   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
 1 Aerobic_~          1.25 Aerobic  Soil        freeze-filter   T0         P1   
 2 Aerobic_~          1.25 Aerobic  Soil        freeze-filter   T1         P2   
 3 Aerobic_~          1.25 Aerobic  Soil        freeze-filter   T2         P3   
 4 Aerobic_~          1.25 Aerobic  Soil        freeze-filter   T3         P3   
 5 Aerobic_~          1.25 Aerobic  Soil        freeze-filter   T4         P4   
 6 Aerobic_~          2.5  Aerobic  Soil        freeze-filter   T0         P1   
 7 Aerobic_~          2.5  Aerobic  Soil        freeze-filter   T1         P2   
 8 Aerobic_~          2.5  Aerobic  Soil        freeze-filter   T2         P3   
 9 Aerobic_~          2.5  Aerobic  Soil        freeze-filter   T3         P3   
10 Aerobic_~          2.5  Aerobic  Soil        freeze-filter   T4         P4   
# ... with 23 more rows, and 10 more variables: Ave_NO2_mM &lt;dbl&gt;,
#   Std_NO2_mM &lt;dbl&gt;, Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;, Time_minutes &lt;chr&gt;,
#   Time_hours &lt;dbl&gt;, Innate_NO3_mM &lt;dbl&gt;, Retrieved_NO3_mM_mcf &lt;dbl&gt;,
#   Ratio_retrieved_mcf &lt;dbl&gt;, Std_Ratio_retrieved_mcf &lt;dbl&gt;</code></pre>
<pre class="r"><code># plot
df_soil_aerobic &lt;- df_NO2NO3_innate_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Aerobic&quot;)

df_soil_method &lt;- df_NO2NO3_innate_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Method_test&quot;)
dim(df_soil_aerobic)</code></pre>
<pre><code>[1]  3 17</code></pre>
<pre class="r"><code>dim(df_soil_method)</code></pre>
<pre><code>[1]  6 17</code></pre>
<pre class="r"><code># Plot for T0 soil sample
df_soil_aerobic$Nitrate_input &lt;- factor(df_soil_aerobic$Nitrate_input)

ggplot(df_soil_aerobic, aes(x=Nitrate_input, y=Ratio_retrieved_mcf)) +  ## I put fill=value which was wrong
  geom_errorbar(aes(ymin=Ratio_retrieved_mcf - Std_Ratio_retrieved_mcf, ymax=Ratio_retrieved_mcf + Std_Ratio_retrieved_mcf), width=.05, position = position_dodge(0.8))+
  geom_bar(stat=&quot;identity&quot;,position=&quot;dodge&quot;, fill = &quot;brown&quot;)+
  geom_line(size=0.2, color=&quot;brown&quot;)+
  ylab(&quot;Ratio of retrieved nitrate concentraion \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,1,0.1), limits=c(0, 1))+
  # scale_x_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  ggtitle(&quot;(After moisture correction) Soil extraction ratio at T0 \n&quot;) +
  geom_text(aes(label = round(Ratio_retrieved_mcf,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-6-3.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Plot for filter-freeze vs freeze-filter soil sample
df_soil_method$Nitrate_input &lt;- factor(df_soil_method$Nitrate_input)

ggplot(df_soil_method, aes(x=Nitrate_input, y=Ratio_retrieved_mcf, fill=Sampling_method, group=Sampling_method)) +
  geom_bar(stat=&quot;identity&quot;,position=&quot;dodge&quot;)+
  geom_errorbar(aes(ymin=Ratio_retrieved_mcf - Std_Ratio_retrieved_mcf, ymax=Ratio_retrieved_mcf + Std_Ratio_retrieved_mcf), width=.05, position = position_dodge(0.8))+
  # geom_line(size=0.2, color=&quot;brown&quot;)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;Ratio of retrieved nitrate concentraion \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,1.2,0.1), limits=c(0, 1.2))+
  # scale_x_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  ggtitle(&quot;(After moisture correction) Comparing freeze-filter vs filter-freeze \n&quot;) +
  geom_text(aes(label = round(Ratio_retrieved_mcf,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE, position = position_dodge(0.8))+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-6-4.png" width="1056" style="display: block; margin: auto;" /></p>
<p>3.4. Blank - nitrate spike correlation correction</p>
<pre class="r"><code>colnames(df_p)</code></pre>
<pre><code> [1] &quot;Well&quot;              &quot;Sample&quot;            &quot;Extraction_method&quot;
 [4] &quot;Extraction_ul&quot;     &quot;Nitrate_input&quot;     &quot;Category&quot;         
 [7] &quot;Sample_type&quot;       &quot;Sampling_method&quot;   &quot;Time_point&quot;       
[10] &quot;Plate&quot;             &quot;NO2_mM&quot;            &quot;NO2NO3_mM&quot;        
[13] &quot;NO3_mM&quot;           </code></pre>
<pre class="r"><code>df_mb_aerobic &lt;- df_p %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Blank&quot;, Category == &quot;Aerobic&quot;)
plot(df_mb_aerobic$Nitrate_input, df_mb_aerobic$NO3_mM)</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code>df_mb_freeze &lt;- df_p %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Blank&quot;, Category == &quot;Method_test&quot;, Sampling_method==&quot;freeze-filter&quot;)
plot(df_mb_freeze$Nitrate_input, df_mb_freeze$NO3_mM)</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code>df_mb_filter &lt;- df_p %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Blank&quot;, Category == &quot;Method_test&quot;, Sampling_method==&quot;filter-freeze&quot;)
plot(df_mb_filter$Nitrate_input, df_mb_filter$NO3_mM)</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-3.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code>fit.mb_aerobic &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_aerobic)
fit.mb_freeze &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_freeze)
fit.mb_filter &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_filter)

# Plot fitted linear regression line - aerobic
ggplot(df_mb_aerobic, aes(x=Nitrate_input, y=NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  # geom_errorbar(aes(ymin=NO3_mM - sd_NO3_mM, ymax=NO3_mM + sd_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  scale_color_manual(values = c(&quot;maroon2&quot;,&quot;deepskyblue4&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,2.5,0.25), limits=c(0, 2.5))+
  # scale_x_continuous(breaks = seq(0,2.1,0.1), limits=c(0, 2.1))+
  # geom_text_repel(aes(label = round(NO3_mM,3)), size = 3,family=&quot;serif&quot;, show.legend = FALSE)+
  ggtitle(&quot;Blank spike in at T0 \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  # regression line
  geom_abline(slope = coef(fit.mb_aerobic)[[2]], intercept = coef(fit.mb_aerobic)[[1]],
              color = &quot;maroon2&quot;) +
  # show equation
  # stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = &quot;~`,`~&quot;))) +
  annotate(&quot;text&quot;,x=2.5,y=5, label= paste0(&quot;y = &quot;, round(coef(fit.mb_aerobic)[[1]],3),&quot;+&quot;,round(coef(fit.mb_aerobic)[[2]],3),&quot;x&quot;), color = &quot;maroon2&quot;) +
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-4.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Plot fitted linear regression line - freeze-filter samples
ggplot(df_mb_freeze, aes(x=Nitrate_input, y=NO3_mM, color=Sampling_method, group=Sampling_method)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  # geom_errorbar(aes(ymin=NO3_mM - sd_NO3_mM, ymax=NO3_mM + sd_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  scale_color_manual(values = c(&quot;maroon2&quot;,&quot;deepskyblue4&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,2.5,0.25), limits=c(0, 2.5))+
  # scale_x_continuous(breaks = seq(0,2.1,0.1), limits=c(0, 2.1))+
  # geom_text_repel(aes(label = round(NO3_mM,3)), size = 3,family=&quot;serif&quot;, show.legend = FALSE)+
  ggtitle(&quot;Blank spike in with freeze-filter method \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  # regression line
  geom_abline(slope = coef(fit.mb_freeze)[[2]], intercept = coef(fit.mb_freeze)[[1]],
              color = &quot;maroon2&quot;) +
  # show equation
  # stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = &quot;~`,`~&quot;))) +
  annotate(&quot;text&quot;,x=2.5,y=5, label= paste0(&quot;y = &quot;, round(coef(fit.mb_freeze)[[1]],3),&quot;+&quot;,round(coef(fit.mb_freeze)[[2]],3),&quot;x&quot;), color = &quot;maroon2&quot;) +
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-5.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Plot fitted linear regression line - filter-freeze method
ggplot(df_mb_filter, aes(x=Nitrate_input, y=NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  # geom_errorbar(aes(ymin=NO3_mM - sd_NO3_mM, ymax=NO3_mM + sd_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  scale_color_manual(values = c(&quot;maroon2&quot;,&quot;deepskyblue4&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,2.5,0.25), limits=c(0, 2.5))+
  # scale_x_continuous(breaks = seq(0,2.1,0.1), limits=c(0, 2.1))+
  # geom_text_repel(aes(label = round(NO3_mM,3)), size = 3,family=&quot;serif&quot;, show.legend = FALSE)+
  ggtitle(&quot;Blank spike in with filter-freeze method \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  # regression line
  geom_abline(slope = coef(fit.mb_filter)[[2]], intercept = coef(fit.mb_filter)[[1]],
              color = &quot;maroon2&quot;) +
  # show equation
  # stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = &quot;~`,`~&quot;))) +
  annotate(&quot;text&quot;,x=2.5,y=5, label= paste0(&quot;y = &quot;, round(coef(fit.mb_filter)[[1]],3),&quot;+&quot;,round(coef(fit.mb_filter)[[2]],3),&quot;x&quot;), color = &quot;maroon2&quot;) +
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-6.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># correction factor... is it reasonable to include correction factor with blanks?
# use the regression equation for correction
# starting from df_NO2NO3_mcf (moisture corrected)

df_anaerobic_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Aerobic&quot;)

df_freeze_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Method_test&quot;, Sampling_method == &quot;freeze-filter&quot;)

df_filter_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == &quot;Method_test&quot;, Sampling_method == &quot;filter-freeze&quot;)

# fit.mb_aerobic &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_aerobic)
# fit.mb_freeze &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_freeze)
# fit.mb_filter &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_filter)

# First T0 sample
# multiplying blank correction factor
df_anaerobic_mcf_bcf &lt;- df_anaerobic_mcf %&gt;% mutate(Ave_NO3_mM = (Ave_NO3_mM - coef(fit.mb_aerobic)[[1]]) / coef(fit.mb_aerobic)[[2]], Std_NO3_mM = Std_NO3_mM / coef(fit.mb_aerobic)[[2]])
# if negative make it 0
df_anaerobic_mcf_bcf$Ave_NO3_mM &lt;- ifelse(df_anaerobic_mcf_bcf$Ave_NO3_mM &lt; 0, 0, df_anaerobic_mcf_bcf$Ave_NO3_mM)
# innate nitrate
add_innate_mcf_bcf &lt;- df_anaerobic_mcf_bcf %&gt;% filter(Sample_type== &quot;Soil&quot;, Nitrate_input == 0) %&gt;% rename(Innate_NO3_mM = Ave_NO3_mM) %&gt;% select(Category, Sample_type, Sampling_method, Time_point, Innate_NO3_mM)

df_anaerobic_mcf_bcf_innate &lt;- df_anaerobic_mcf_bcf %&gt;% filter(Sample_type== &quot;Soil&quot;, Nitrate_input != 0) %&gt;% arrange(Sample) %&gt;%
  left_join(add_innate_mcf_bcf, by=c(&quot;Category&quot;=&quot;Category&quot;, &quot;Sample_type&quot;=&quot;Sample_type&quot;, &quot;Sampling_method&quot;=&quot;Sampling_method&quot;, &quot;Time_point&quot;=&quot;Time_point&quot;)) %&gt;% 
  mutate(Retrieved_NO3_mM_mcf_bcf = Ave_NO3_mM - Innate_NO3_mM)

# Retrieved ratio of spike ins
df_anaerobic_mcf_bcf_innate$Ratio_retrieved_mcf_bcf &lt;- df_anaerobic_mcf_bcf_innate$Retrieved_NO3_mM_mcf_bcf / df_anaerobic_mcf_bcf_innate$Nitrate_input 
df_anaerobic_mcf_bcf_innate$Std_Ratio_retrieved_mcf_bcf &lt;- df_anaerobic_mcf_bcf_innate$Std_NO3_mM / df_anaerobic_mcf_bcf_innate$Nitrate_input 

df_anaerobic_mcf_bcf_innate</code></pre>
<pre><code># A tibble: 3 x 17
  Sample     Nitrate_input Category Sample_type Sampling_method Time_point Plate
  &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
1 Aerobic_1~          1.25 Aerobic  Soil        freeze-filter   T0         P1   
2 Aerobic_2~          2.5  Aerobic  Soil        freeze-filter   T0         P1   
3 Aerobic_5~          5    Aerobic  Soil        freeze-filter   T0         P1   
# ... with 10 more variables: Ave_NO2_mM &lt;dbl&gt;, Std_NO2_mM &lt;dbl&gt;,
#   Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;, Time_minutes &lt;chr&gt;, Time_hours &lt;dbl&gt;,
#   Innate_NO3_mM &lt;dbl&gt;, Retrieved_NO3_mM_mcf_bcf &lt;dbl&gt;,
#   Ratio_retrieved_mcf_bcf &lt;dbl&gt;, Std_Ratio_retrieved_mcf_bcf &lt;dbl&gt;</code></pre>
<pre class="r"><code># plot
df_anaerobic_mcf_bcf_innate$Nitrate_input &lt;- factor(df_anaerobic_mcf_bcf_innate$Nitrate_input)

ggplot(df_anaerobic_mcf_bcf_innate, aes(x=Nitrate_input, y=Ratio_retrieved_mcf_bcf)) +  ## I put fill=value which was wrong
  geom_bar(stat=&quot;identity&quot;,position=&quot;dodge&quot;, fill = &quot;brown&quot;)+
  geom_line(size=0.2, color=&quot;brown&quot;)+
  ylab(&quot;Ratio of retrieved nitrate concentraion \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,1,0.1), limits=c(0, 1))+
  # scale_x_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  ggtitle(&quot;(Moisture + blank correction) Soil extraction ratio at T0 \n&quot;) +
  geom_text(aes(label = round(Ratio_retrieved_mcf_bcf,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-7.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Second freeze-filter vs filter-freeze
df_freeze_mcf</code></pre>
<pre><code># A tibble: 4 x 13
  Sample     Nitrate_input Category Sample_type Sampling_method Time_point Plate
  &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
1 Method_te~          0    Method_~ Soil        freeze-filter   T0         P1   
2 Method_te~          1.25 Method_~ Soil        freeze-filter   T0         P1   
3 Method_te~          2.5  Method_~ Soil        freeze-filter   T0         P1   
4 Method_te~          5    Method_~ Soil        freeze-filter   T0         P1   
# ... with 6 more variables: Ave_NO2_mM &lt;dbl&gt;, Std_NO2_mM &lt;dbl&gt;,
#   Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;, Time_minutes &lt;chr&gt;, Time_hours &lt;dbl&gt;</code></pre>
<pre class="r"><code># function for calculating soil extraction ratio
extraction_ratio &lt;- function(df_anaerobic_mcf_bcf){
  # innate nitrate
  add_innate_mcf_bcf &lt;- df_anaerobic_mcf_bcf %&gt;% filter(Sample_type== &quot;Soil&quot;, Nitrate_input == 0) %&gt;% rename(Innate_NO3_mM = Ave_NO3_mM) %&gt;% select(Category, Sample_type, Sampling_method, Time_point, Innate_NO3_mM)
  
  df_anaerobic_mcf_bcf_innate &lt;- df_anaerobic_mcf_bcf %&gt;% filter(Sample_type== &quot;Soil&quot;, Nitrate_input != 0) %&gt;% arrange(Sample) %&gt;%
    left_join(add_innate_mcf_bcf, by=c(&quot;Category&quot;=&quot;Category&quot;, &quot;Sample_type&quot;=&quot;Sample_type&quot;, &quot;Sampling_method&quot;=&quot;Sampling_method&quot;, &quot;Time_point&quot;=&quot;Time_point&quot;)) %&gt;% 
    mutate(Retrieved_NO3_mM_mcf_bcf = Ave_NO3_mM - Innate_NO3_mM)
  
  # Retrieved ratio of spike ins
  df_anaerobic_mcf_bcf_innate$Ratio_retrieved_mcf_bcf &lt;- df_anaerobic_mcf_bcf_innate$Retrieved_NO3_mM_mcf_bcf / df_anaerobic_mcf_bcf_innate$Nitrate_input 
  df_anaerobic_mcf_bcf_innate$Std_Ratio_retrieved_mcf_bcf &lt;- df_anaerobic_mcf_bcf_innate$Std_NO3_mM / df_anaerobic_mcf_bcf_innate$Nitrate_input 
  return(df_anaerobic_mcf_bcf_innate)
}

# function for blank correction
blank_correction &lt;- function(df_p, df_NO2NO3_mcf, cat=&quot;Aerobic&quot;, met=&quot;freeze-filter&quot;){
  # get Category
  df_mb_aerobic &lt;- df_p %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Blank&quot;, Category == cat, Sampling_method==met)
  # linear regression
  fit.mb_aerobic &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_aerobic)
  # moisture corrected
  df_anaerobic_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Sample_type == &quot;Soil&quot;, Category == cat, Sampling_method==met)

  # multiplying blank correction factor
  df_anaerobic_mcf_bcf &lt;- df_anaerobic_mcf %&gt;% mutate(Ave_NO3_mM = (Ave_NO3_mM - coef(fit.mb_aerobic)[[1]]) / coef(fit.mb_aerobic)[[2]], Std_NO3_mM = Std_NO3_mM / coef(fit.mb_aerobic)[[2]])
  # if negative make it 0
  df_anaerobic_mcf_bcf$Ave_NO3_mM &lt;- ifelse(df_anaerobic_mcf_bcf$Ave_NO3_mM &lt; 0, 0, df_anaerobic_mcf_bcf$Ave_NO3_mM)
  return(df_anaerobic_mcf_bcf)
}

blank_correction(df_p, df_NO2NO3_mcf, cat=&quot;Aerobic&quot;, met=&quot;freeze-filter&quot;)</code></pre>
<pre><code># A tibble: 4 x 13
  Sample     Nitrate_input Category Sample_type Sampling_method Time_point Plate
  &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
1 Aerobic_0~          0    Aerobic  Soil        freeze-filter   T0         P1   
2 Aerobic_1~          1.25 Aerobic  Soil        freeze-filter   T0         P1   
3 Aerobic_2~          2.5  Aerobic  Soil        freeze-filter   T0         P1   
4 Aerobic_5~          5    Aerobic  Soil        freeze-filter   T0         P1   
# ... with 6 more variables: Ave_NO2_mM &lt;dbl&gt;, Std_NO2_mM &lt;dbl&gt;,
#   Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;, Time_minutes &lt;chr&gt;, Time_hours &lt;dbl&gt;</code></pre>
<pre class="r"><code># blank correction + calculate extraction ratio
df_freeze_mcf_bcf_innate &lt;- extraction_ratio(blank_correction(df_p, df_NO2NO3_mcf, cat=&quot;Method_test&quot;,met=&quot;freeze-filter&quot;))

df_filter_mcf_bcf_innate &lt;- extraction_ratio(blank_correction(df_p, df_NO2NO3_mcf, cat=&quot;Method_test&quot;,met=&quot;filter-freeze&quot;))

colnames(df_freeze_mcf_bcf_innate)</code></pre>
<pre><code> [1] &quot;Sample&quot;                      &quot;Nitrate_input&quot;              
 [3] &quot;Category&quot;                    &quot;Sample_type&quot;                
 [5] &quot;Sampling_method&quot;             &quot;Time_point&quot;                 
 [7] &quot;Plate&quot;                       &quot;Ave_NO2_mM&quot;                 
 [9] &quot;Std_NO2_mM&quot;                  &quot;Ave_NO3_mM&quot;                 
[11] &quot;Std_NO3_mM&quot;                  &quot;Time_minutes&quot;               
[13] &quot;Time_hours&quot;                  &quot;Innate_NO3_mM&quot;              
[15] &quot;Retrieved_NO3_mM_mcf_bcf&quot;    &quot;Ratio_retrieved_mcf_bcf&quot;    
[17] &quot;Std_Ratio_retrieved_mcf_bcf&quot;</code></pre>
<pre class="r"><code>df_ff &lt;- rbind(df_freeze_mcf_bcf_innate, df_filter_mcf_bcf_innate)

# Plot for filter-freeze vs freeze-filter soil sample
df_ff$Nitrate_input &lt;- factor(df_ff$Nitrate_input)

ggplot(df_ff, aes(x=Nitrate_input, y=Ratio_retrieved_mcf_bcf, fill=Sampling_method, group=Sampling_method)) +
  geom_bar(stat=&quot;identity&quot;,position=&quot;dodge&quot;)+
  geom_errorbar(aes(ymin=Ratio_retrieved_mcf_bcf - Std_Ratio_retrieved_mcf_bcf, ymax=Ratio_retrieved_mcf_bcf + Std_Ratio_retrieved_mcf_bcf), width=.05, position = position_dodge(0.8))+
  # geom_line(size=0.2, color=&quot;brown&quot;)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;Ratio of retrieved nitrate concentraion \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,1.2,0.1), limits=c(0, 1.2))+
  # scale_x_continuous(breaks = seq(0,2.1,0.25), limits=c(0, 2.1))+
  ggtitle(&quot;(Moisture + Blank correction) Comparing freeze-filter vs filter-freeze \n&quot;) +
  geom_text(aes(label = round(Ratio_retrieved_mcf_bcf,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE, position = position_dodge(0.8))+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-8.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># just plot scatter (moisture + blank correction)
# T0 sample
ggplot(df_anaerobic_mcf_bcf, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sample_type, group=Sample_type)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  # scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  scale_x_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  ggtitle(&quot;Soil test (t=0) (after moisture + blank correction) \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-9.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># only method test
df_freeze_mcf_bcf &lt;- blank_correction(df_p, df_NO2NO3_mcf, cat=&quot;Method_test&quot;,met=&quot;freeze-filter&quot;)
df_filter_mcf_bcf &lt;- blank_correction(df_p, df_NO2NO3_mcf, cat=&quot;Method_test&quot;,met=&quot;filter-freeze&quot;)
df_ff_bcf &lt;- rbind(df_freeze_mcf_bcf, df_filter_mcf_bcf)

ggplot(df_ff_bcf, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Sampling_method, group=Sampling_method)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,6,1), limits=c(0, 6))+
  scale_x_continuous(breaks = seq(0,5.1,1), limits=c(0, 5.1))+
  ggtitle(&quot;Soil test (after moisture + blank correction) \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-7-10.png" width="1056" style="display: block; margin: auto;" /></p>
</div>
<div id="plot-without-blank-correction" class="section level2">
<h2>4. Plot without blank correction</h2>
</div>
<div id="anaerobic-method-dynamics" class="section level2">
<h2>4.1. Anaerobic method dynamics</h2>
<pre class="r"><code># Anaerobic method dynamics (first work with moisture corrected)
df_anae &lt;- df_NO2NO3_mcf %&gt;% filter(Category == &quot;Anaerobic&quot;, Sample_type == &quot;Soil&quot;)
df_T0 &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Category == &quot;Aerobic&quot;, Sample_type == &quot;Soil&quot;)
df_anae &lt;- rbind(df_T0, df_anae)
dim(df_anae)</code></pre>
<pre><code>[1] 20 13</code></pre>
<pre class="r"><code>colnames(df_anae)</code></pre>
<pre><code> [1] &quot;Sample&quot;          &quot;Nitrate_input&quot;   &quot;Category&quot;        &quot;Sample_type&quot;    
 [5] &quot;Sampling_method&quot; &quot;Time_point&quot;      &quot;Plate&quot;           &quot;Ave_NO2_mM&quot;     
 [9] &quot;Std_NO2_mM&quot;      &quot;Ave_NO3_mM&quot;      &quot;Std_NO3_mM&quot;      &quot;Time_minutes&quot;   
[13] &quot;Time_hours&quot;     </code></pre>
<pre class="r"><code>df_anae$Nitrate_input &lt;- factor(df_anae$Nitrate_input)

# Time point
ggplot(df_anae, aes(x=Time_point, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Anaerobic NO3 dynamic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-8-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Hours
Time_table</code></pre>
<pre><code>  Time_point Time_minutes Time_hours
1         T0            0    0.00000
2         T1          420    7.00000
3         T2         1340   22.33333
4         T3         1810   30.16667
5         T4         2890   48.16667</code></pre>
<pre class="r"><code>ggplot(df_anae, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Anaerobic NO3 dynamic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-8-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Nitrite dynamics
ggplot(df_anae, aes(x=Time_hours, y=Ave_NO2_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO2_mM - Std_NO2_mM, ymax=Ave_NO2_mM + Std_NO2_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO2- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  scale_y_continuous(breaks = seq(0,0.05,0.01), limits=c(0, 0.05))+
  ggtitle(&quot;Anaerobic NO2 dynamic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO2_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-8-3.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Are blanks changing or constant?
# Anaerobic method dynamics
df_anae_b &lt;- df_NO2NO3_mcf %&gt;% filter(Category == &quot;Anaerobic&quot;, Sample_type == &quot;Blank&quot;)
df_T0 &lt;- df_NO2NO3_mcf %&gt;% filter(Plate == &quot;P1&quot;, Category == &quot;Aerobic&quot;, Sample_type == &quot;Blank&quot;)
df_anae_b &lt;- rbind(df_T0, df_anae_b)
dim(df_anae_b)</code></pre>
<pre><code>[1] 20 13</code></pre>
<pre class="r"><code>colnames(df_anae_b)</code></pre>
<pre><code> [1] &quot;Sample&quot;          &quot;Nitrate_input&quot;   &quot;Category&quot;        &quot;Sample_type&quot;    
 [5] &quot;Sampling_method&quot; &quot;Time_point&quot;      &quot;Plate&quot;           &quot;Ave_NO2_mM&quot;     
 [9] &quot;Std_NO2_mM&quot;      &quot;Ave_NO3_mM&quot;      &quot;Std_NO3_mM&quot;      &quot;Time_minutes&quot;   
[13] &quot;Time_hours&quot;     </code></pre>
<pre class="r"><code>df_anae_b$Nitrate_input &lt;- factor(df_anae_b$Nitrate_input)

# Time point
ggplot(df_anae_b, aes(x=Time_point, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Blank in Anaerobic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-8-4.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Hours
Time_table</code></pre>
<pre><code>  Time_point Time_minutes Time_hours
1         T0            0    0.00000
2         T1          420    7.00000
3         T2         1340   22.33333
4         T3         1810   30.16667
5         T4         2890   48.16667</code></pre>
<pre class="r"><code>ggplot(df_anae_b, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Blank in Anaerobic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-8-5.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Blank nitrite
ggplot(df_anae_b, aes(x=Time_hours, y=Ave_NO2_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO2_mM - Std_NO2_mM, ymax=Ave_NO2_mM + Std_NO2_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO2- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  scale_y_continuous(breaks = seq(0,0.1,0.05), limits=c(0, 0.1))+
  ggtitle(&quot;Blank in Anaerobic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO2_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-8-6.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Calculate evaporation rate
(5.964 - 4.859) / 48.16667 # 0.023mM increase per hour</code></pre>
<pre><code>[1] 0.02294117</code></pre>
<pre class="r"><code>df_eva &lt;- df_anae_b %&gt;% select(Nitrate_input, Time_point, Time_hours, Ave_NO3_mM) %&gt;% filter(Time_point ==&quot;T4&quot;)
df_eva2 &lt;- df_anae_b %&gt;% filter(Time_point ==&quot;T0&quot;) %&gt;% select(Nitrate_input, Ave_NO3_mM) %&gt;% rename(Ini_NO3_mM = Ave_NO3_mM)
df_eva &lt;- df_eva %&gt;% left_join(df_eva2, by =c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;)) 
df_eva &lt;- df_eva %&gt;% mutate(Delta_NO3_mM = Ave_NO3_mM - Ini_NO3_mM) %&gt;% mutate(Concentration_change_hr = Delta_NO3_mM / Time_hours)

# soil weight(0.75g) / spike in volume (1.5ml)
moisture_percent = 26.4
Volume_initial = 0.75*(moisture_percent/100) + 1.5
Volume_endpoint = (Volume_initial * 4.859) / 5.964 ## 1.383397
evaporation_rate_hr = (Volume_initial - Volume_endpoint) / 48.16667 ## 0.0065ml / hr

# evaporation rate
df_eva$Volume_initial &lt;- Volume_initial
df_eva &lt;- df_eva %&gt;% mutate(Volume_endpoint = Volume_initial * Ini_NO3_mM / Ave_NO3_mM)
df_eva_anae &lt;- df_eva %&gt;% mutate(evaporation_rate_hr = (Volume_initial - Volume_endpoint) / Time_hours)

get_evaporation_rate &lt;- function(df_anae_b, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5){
  df_eva &lt;- df_anae_b %&gt;% select(Nitrate_input, Time_point, Time_hours, Ave_NO3_mM) %&gt;% filter(Time_point ==&quot;T4&quot;)
  df_eva2 &lt;- df_anae_b %&gt;% filter(Time_point ==&quot;T0&quot;) %&gt;% select(Nitrate_input, Ave_NO3_mM) %&gt;% rename(Ini_NO3_mM = Ave_NO3_mM)
  df_eva &lt;- df_eva %&gt;% left_join(df_eva2, by =c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;)) 
  df_eva &lt;- df_eva %&gt;% mutate(Delta_NO3_mM = Ave_NO3_mM - Ini_NO3_mM) %&gt;% mutate(Concentration_change_hr = Delta_NO3_mM / Time_hours)
  
  # soil weight(0.75g) / spike in volume (1.5ml)
  Volume_initial = soil_weight*(moisture_percent/100) + water_input
  # Volume_endpoint = (Volume_initial * 4.859) / 5.964 ## 1.383397
  # evaporation_rate_hr = (Volume_initial - Volume_endpoint) / 48.16667 ## 0.0065ml / hr
  
  # evaporation rate
  df_eva$Volume_initial &lt;- Volume_initial
  df_eva &lt;- df_eva %&gt;% mutate(Volume_endpoint = Volume_initial * Ini_NO3_mM / Ave_NO3_mM)
  df_eva_anae &lt;- df_eva %&gt;% mutate(evaporation_rate_hr = (Volume_initial - Volume_endpoint) / Time_hours)
}

get_evaporation_rate_interval &lt;- function(df_anae_b, initial=&quot;T1&quot;,end=&quot;T2&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5){
  df_eva &lt;- df_anae_b %&gt;% select(Nitrate_input, Time_point, Time_hours, Ave_NO3_mM) %&gt;% filter(Time_point == end) %&gt;% rename(End_NO3_mM = Ave_NO3_mM)
  df_eva2 &lt;- df_anae_b %&gt;% filter(Time_point ==initial) %&gt;% select(Nitrate_input, Ave_NO3_mM) %&gt;% rename(Ini_NO3_mM = Ave_NO3_mM)
  df_eva &lt;- df_eva %&gt;% left_join(df_eva2, by =c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;)) 
  df_eva &lt;- df_eva %&gt;% mutate(Delta_NO3_mM = End_NO3_mM - Ini_NO3_mM) %&gt;% mutate(Concentration_change_hr = Delta_NO3_mM / Time_hours)
  
  # soil weight(0.75g) / spike in volume (1.5ml)
  Volume_T0 = soil_weight*(moisture_percent/100) + water_input
  # Add T0 Ave_NO3_mM
  df_TO_NO3 &lt;- df_anae_b %&gt;% filter(Time_point == &quot;T0&quot;) %&gt;% select(Nitrate_input, Ave_NO3_mM) %&gt;% rename(T0_NO3_mM = Ave_NO3_mM)
  df_eva &lt;- df_eva %&gt;% left_join(df_TO_NO3, by =c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;)) 

  # evaporation rate
  df_eva &lt;- df_eva %&gt;% mutate(Volume_initial = Volume_T0 * T0_NO3_mM / Ini_NO3_mM)
  df_eva &lt;- df_eva %&gt;% mutate(Volume_endpoint = Volume_T0 * T0_NO3_mM / End_NO3_mM)
  df_eva_anae &lt;- df_eva %&gt;% mutate(evaporation_rate_hr = (Volume_initial - Volume_endpoint) / Time_hours)
  return(df_eva_anae)
}


# For anaerobic blanks, get evaporation rate
df_ev_an_1 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T0&quot;,end=&quot;T1&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_an_2 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T1&quot;,end=&quot;T2&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_an_3 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T2&quot;,end=&quot;T3&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_an_4 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T3&quot;,end=&quot;T4&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)

df_ev_an &lt;- rbind(df_ev_an_1, df_ev_an_2, df_ev_an_3, df_ev_an_4)
df_ev_an %&lt;&gt;% filter(!(Nitrate_input==0)) 

ggplot(df_ev_an, aes(x=Time_hours, y=evaporation_rate_hr, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  scale_color_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;Evaporation rate (ml / hr) \n&quot;) +
  xlab(&quot;\n Nitrate input (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.02,0.01), limits=c(0, 0.02))+
  ggtitle(&quot;Evaporation rate of blank in Anaerobic (ml/hr) \n&quot;) +
  # label
  geom_text(aes(label = round(evaporation_rate_hr,4)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-8-7.png" width="1056" style="display: block; margin: auto;" /></p>
</div>
<div id="aerobic-dynamics" class="section level2">
<h2>4.2. Aerobic dynamics</h2>
<pre class="r"><code># Anaerobic method dynamics (first work with moisture corrected)
df_aero &lt;- df_NO2NO3_mcf %&gt;% filter(Category == &quot;Aerobic&quot;, Sample_type == &quot;Soil&quot;)
dim(df_aero)</code></pre>
<pre><code>[1] 20 13</code></pre>
<pre class="r"><code>colnames(df_aero)</code></pre>
<pre><code> [1] &quot;Sample&quot;          &quot;Nitrate_input&quot;   &quot;Category&quot;        &quot;Sample_type&quot;    
 [5] &quot;Sampling_method&quot; &quot;Time_point&quot;      &quot;Plate&quot;           &quot;Ave_NO2_mM&quot;     
 [9] &quot;Std_NO2_mM&quot;      &quot;Ave_NO3_mM&quot;      &quot;Std_NO3_mM&quot;      &quot;Time_minutes&quot;   
[13] &quot;Time_hours&quot;     </code></pre>
<pre class="r"><code>df_aero$Nitrate_input &lt;- factor(df_aero$Nitrate_input)

# Time point
ggplot(df_aero, aes(x=Time_point, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Aerobic NO3 dynamic - No carbon added (no contamination) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Hours
Time_table</code></pre>
<pre><code>  Time_point Time_minutes Time_hours
1         T0            0    0.00000
2         T1          420    7.00000
3         T2         1340   22.33333
4         T3         1810   30.16667
5         T4         2890   48.16667</code></pre>
<pre class="r"><code>ggplot(df_aero, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Aerobic NO3 dynamic - No carbon added (no contamination) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Nitrite dynamics
ggplot(df_aero, aes(x=Time_hours, y=Ave_NO2_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO2_mM - Std_NO2_mM, ymax=Ave_NO2_mM + Std_NO2_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO2- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  scale_y_continuous(breaks = seq(0,0.1,0.01), limits=c(0, 0.1))+
  ggtitle(&quot;Aerobic NO2 dynamic - No carbon added (no contamination) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO2_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-3.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Are blanks changing or constant?
# Aerobic method dynamics
df_aero_b &lt;- df_NO2NO3_mcf %&gt;% filter(Category == &quot;Aerobic&quot;, Sample_type == &quot;Blank&quot;)
dim(df_aero_b)</code></pre>
<pre><code>[1] 20 13</code></pre>
<pre class="r"><code>colnames(df_aero_b)</code></pre>
<pre><code> [1] &quot;Sample&quot;          &quot;Nitrate_input&quot;   &quot;Category&quot;        &quot;Sample_type&quot;    
 [5] &quot;Sampling_method&quot; &quot;Time_point&quot;      &quot;Plate&quot;           &quot;Ave_NO2_mM&quot;     
 [9] &quot;Std_NO2_mM&quot;      &quot;Ave_NO3_mM&quot;      &quot;Std_NO3_mM&quot;      &quot;Time_minutes&quot;   
[13] &quot;Time_hours&quot;     </code></pre>
<pre class="r"><code>df_aero_b$Nitrate_input &lt;- factor(df_aero_b$Nitrate_input)

# Time point
ggplot(df_aero_b, aes(x=Time_point, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Blank in Aerobic - No carbon added (no contamination) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-4.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Hours
Time_table</code></pre>
<pre><code>  Time_point Time_minutes Time_hours
1         T0            0    0.00000
2         T1          420    7.00000
3         T2         1340   22.33333
4         T3         1810   30.16667
5         T4         2890   48.16667</code></pre>
<pre class="r"><code>ggplot(df_aero_b, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;Blank in Aerobic - No carbon added (no contamination) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-5.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Blank-nitrite
ggplot(df_aero_b, aes(x=Time_hours, y=Ave_NO2_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO2_mM - Std_NO2_mM, ymax=Ave_NO2_mM + Std_NO2_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO2- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  scale_y_continuous(breaks = seq(0,0.1,0.05), limits=c(0, 0.1))+
  ggtitle(&quot;Blank in Aerobic - No carbon added (no contamination) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO2_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-6.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code>df_eva_anae &lt;- get_evaporation_rate(df_anae_b, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_eva_aero &lt;- get_evaporation_rate(df_aero_b, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)

## Plot evaporation rate (ml per hour)
df_eva_anae$Condition &lt;- &quot;Anaerobic&quot;
df_eva_aero$Condition &lt;- &quot;Aerobic&quot;

df_eva_both &lt;- rbind(df_eva_anae, df_eva_aero) %&gt;% filter(!(Nitrate_input==0))

ggplot(df_eva_both, aes(x=Nitrate_input, y=evaporation_rate_hr, color=Condition, group=Condition )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  scale_color_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;Evaporation rate (ml / hr) \n&quot;) +
  xlab(&quot;\n Nitrate input (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,0.02,0.01), limits=c(0, 0.02))+
  ggtitle(&quot;Evaporation rate of blank (ml/hr) \n&quot;) +
  # label
  geom_text(aes(label = round(evaporation_rate_hr,4)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-7.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## plot concentration change rate
ggplot(df_eva_both, aes(x=Nitrate_input, y=Rate_mM, color=Condition, group=Condition )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  scale_color_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;mM / hr \n&quot;) +
  xlab(&quot;\n Nitrate input (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.02,0.01), limits=c(0, 0.02))+
  ggtitle(&quot;Nitrate concentration increase rate of blank (mM/hr) \n&quot;) +
  # label
  geom_text(aes(label = round(Rate_mM,4)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<pre><code>Error in FUN(X[[i]], ...): object &#39;Rate_mM&#39; not found</code></pre>
<pre class="r"><code># For anaerobic blanks, get evaporation rate
df_ev_an_1 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T0&quot;,end=&quot;T1&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_an_2 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T1&quot;,end=&quot;T2&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_an_3 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T2&quot;,end=&quot;T3&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_an_4 &lt;- get_evaporation_rate_interval(df_anae_b, initial=&quot;T3&quot;,end=&quot;T4&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)

df_ev_an &lt;- rbind(df_ev_an_1, df_ev_an_2, df_ev_an_3, df_ev_an_4)
df_ev_an %&lt;&gt;% filter(!(Nitrate_input==0)) 

ggplot(df_ev_an, aes(x=Time_hours, y=evaporation_rate_hr, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  scale_color_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;Evaporation rate (ml / hr) \n&quot;) +
  xlab(&quot;\n Nitrate input (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.02,0.01), limits=c(0, 0.02))+
  ggtitle(&quot;Evaporation rate of blank in Anaerobic (ml/hr) \n&quot;) +
  # label
  geom_text(aes(label = round(evaporation_rate_hr,4)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-8.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># for aerobic
# For anaerobic blanks, get evaporation rate
df_ev_ae_1 &lt;- get_evaporation_rate_interval(df_aero_b, initial=&quot;T0&quot;,end=&quot;T1&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_ae_2 &lt;- get_evaporation_rate_interval(df_aero_b, initial=&quot;T1&quot;,end=&quot;T2&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_ae_3 &lt;- get_evaporation_rate_interval(df_aero_b, initial=&quot;T2&quot;,end=&quot;T3&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)
df_ev_ae_4 &lt;- get_evaporation_rate_interval(df_aero_b, initial=&quot;T3&quot;,end=&quot;T4&quot;, moisture_percent = 26.4, soil_weight=0.75, water_input=1.5)

df_ev_ae &lt;- rbind(df_ev_ae_1, df_ev_ae_2, df_ev_ae_3, df_ev_ae_4)
df_ev_ae %&lt;&gt;% filter(!(Nitrate_input==0)) 

ggplot(df_ev_ae, aes(x=Time_hours, y=evaporation_rate_hr, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  scale_color_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;Evaporation rate (ml / hr) \n&quot;) +
  xlab(&quot;\n Nitrate input (mM)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.02,0.01), limits=c(0, 0.02))+
  ggtitle(&quot;Evaporation rate of blank in Aerobic (ml/hr) \n&quot;) +
  # label
  geom_text(aes(label = round(evaporation_rate_hr,4)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-9-9.png" width="1056" style="display: block; margin: auto;" /></p>
</div>
<div id="after-blank-correction-method1" class="section level2">
<h2>4.3. After blank correction (method1)</h2>
<p>Use standard curves to do the correction</p>
<pre class="r"><code># before blank correction
df_NO2NO3_mcf %&gt;% filter(Sample_type == &quot;Blank&quot;)</code></pre>
<pre><code># A tibble: 44 x 13
   Sample    Nitrate_input Category Sample_type Sampling_method Time_point Plate
   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
 1 Aerobic_~          0    Aerobic  Blank       freeze-filter   T0         P1   
 2 Aerobic_~          0    Aerobic  Blank       freeze-filter   T1         P2   
 3 Aerobic_~          0    Aerobic  Blank       freeze-filter   T2         P3   
 4 Aerobic_~          0    Aerobic  Blank       freeze-filter   T3         P3   
 5 Aerobic_~          0    Aerobic  Blank       freeze-filter   T4         P4   
 6 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T0         P1   
 7 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T1         P2   
 8 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T2         P3   
 9 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T3         P3   
10 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T4         P4   
# ... with 34 more rows, and 6 more variables: Ave_NO2_mM &lt;dbl&gt;,
#   Std_NO2_mM &lt;dbl&gt;, Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;, Time_minutes &lt;chr&gt;,
#   Time_hours &lt;dbl&gt;</code></pre>
<pre class="r"><code>df_NO2NO3_blank_mcf</code></pre>
<pre><code># A tibble: 44 x 11
   Sample    Nitrate_input Category Sample_type Sampling_method Time_point Plate
   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;       &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
 1 Aerobic_~          0    Aerobic  Blank       freeze-filter   T0         P1   
 2 Aerobic_~          0    Aerobic  Blank       freeze-filter   T1         P2   
 3 Aerobic_~          0    Aerobic  Blank       freeze-filter   T2         P3   
 4 Aerobic_~          0    Aerobic  Blank       freeze-filter   T3         P3   
 5 Aerobic_~          0    Aerobic  Blank       freeze-filter   T4         P4   
 6 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T0         P1   
 7 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T1         P2   
 8 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T2         P3   
 9 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T3         P3   
10 Aerobic_~          1.25 Aerobic  Blank       freeze-filter   T4         P4   
# ... with 34 more rows, and 4 more variables: Ave_NO2_mM &lt;dbl&gt;,
#   Std_NO2_mM &lt;dbl&gt;, Ave_NO3_mM &lt;dbl&gt;, Std_NO3_mM &lt;dbl&gt;</code></pre>
<pre class="r"><code>ggplot(df_NO2NO3_blank_mcf, aes(x=Nitrate_input, y=Ave_NO3_mM, color=Time_point, group=Time_point)) +
  geom_point(size=2.5, shape=21) +
  # geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  # scale_color_brewer(palette=&#39;Set2&#39;) +
  # scale_color_manual(values = c(&quot;deepskyblue4&quot;,&quot;maroon2&quot;))+
  ylab(&quot;Measured NO3- (mM) \n&quot;) +
  xlab(&quot;\n Nitrate_spike_in (mM)&quot;) +
  scale_y_continuous(breaks = seq(0,5.5,1), limits=c(0, 5.5))+
  scale_x_continuous(breaks = seq(0,5.5,1), limits=c(0, 5.5))+
  ggtitle(&quot;Blank test \n&quot;) +
  geom_abline(slope = 1, intercept=0, show.legend = &quot;y=x&quot;)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-10-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># function for blank correction
blank_correction_time &lt;- function(df_p, df_NO2NO3_mcf, cat=&quot;Aerobic&quot;, t=&quot;T1&quot;){
  # get Category
  df_mb_aerobic &lt;- df_p %&gt;% filter(Sample_type == &quot;Blank&quot;, Category == cat, Time_point==t)
  # plot(df_mb_aerobic$Nitrate_input, df_mb_aerobic$NO3_mM)
  # linear regression
  fit.mb_aerobic &lt;- lm(NO3_mM ~ Nitrate_input, df_mb_aerobic)
  # moisture corrected
  df_anaerobic_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Sample_type == &quot;Soil&quot;, Category == cat, Time_point==t)

  # multiplying blank correction factor
  df_anaerobic_mcf_bcf &lt;- df_anaerobic_mcf %&gt;% mutate(Ave_NO3_mM = (Ave_NO3_mM - coef(fit.mb_aerobic)[[1]]) / coef(fit.mb_aerobic)[[2]], Std_NO3_mM = Std_NO3_mM / coef(fit.mb_aerobic)[[2]])
  # if negative make it 0
  df_anaerobic_mcf_bcf$Ave_NO3_mM &lt;- ifelse(df_anaerobic_mcf_bcf$Ave_NO3_mM &lt; 0, 0, df_anaerobic_mcf_bcf$Ave_NO3_mM)
  print(dim(df_anaerobic_mcf_bcf))
  return(df_anaerobic_mcf_bcf)
}

vec_time_point &lt;- df_NO2NO3_mcf$Time_point %&gt;% unique()

df_anae_bcf &lt;- blank_correction_time(df_p, df_NO2NO3_mcf, cat=&quot;Aerobic&quot;, t=&quot;T0&quot;)</code></pre>
<pre><code>[1]  4 13</code></pre>
<pre class="r"><code>for (i in vec_time_point[2:length(vec_time_point)]){
  print(i)
  df_anae_bcf &lt;- rbind(df_anae_bcf, blank_correction_time(df_p, df_NO2NO3_mcf, cat=&quot;Anaerobic&quot;, t=i))
}</code></pre>
<pre><code>[1] &quot;T1&quot;
[1]  4 13
[1] &quot;T2&quot;
[1]  4 13
[1] &quot;T3&quot;
[1]  4 13
[1] &quot;T4&quot;
[1]  4 13</code></pre>
<pre class="r"><code>dim(df_anae_bcf)</code></pre>
<pre><code>[1] 20 13</code></pre>
<pre class="r"><code>df_aero_bcf &lt;- data.frame()
for (i in vec_time_point){
  print(i)
  df_aero_bcf &lt;- rbind(df_aero_bcf, blank_correction_time(df_p, df_NO2NO3_mcf, cat=&quot;Aerobic&quot;, t=i))
}</code></pre>
<pre><code>[1] &quot;T0&quot;
[1]  4 13
[1] &quot;T1&quot;
[1]  4 13
[1] &quot;T2&quot;
[1]  4 13
[1] &quot;T3&quot;
[1]  4 13
[1] &quot;T4&quot;
[1]  4 13</code></pre>
<pre class="r"><code>dim(df_aero_bcf)</code></pre>
<pre><code>[1] 20 13</code></pre>
<pre class="r"><code># 1. Anaerobic Nitrate dynamics
df_anae_bcf$Nitrate_input &lt;- factor(df_anae_bcf$Nitrate_input)

ggplot(df_anae_bcf, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;(After blank correction) Anaerobic NO3 dynamic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-10-2.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Nitrite dynamics??

# 2. Aerobic NO3 dynamics
df_aero_bcf$Nitrate_input &lt;- factor(df_aero_bcf$Nitrate_input)

ggplot(df_aero_bcf, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;(After blank correction) Aerobic NO3 dynamic - No carbon added (no contamination) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-10-3.png" width="1056" style="display: block; margin: auto;" /></p>
</div>
<div id="after-blank-correction-method2" class="section level2">
<h2>4.4. After blank correction (method2)</h2>
<p>Use the nitrate concentration of the blank and use the ratio. For example, multiply to nitrate concentration x (2mM / changed [NO3])</p>
<pre class="r"><code># Blank reads
df_aero_blank &lt;- df_aero_b
df_aero_blank$Nitrate_input &lt;- as.numeric(as.character(df_aero_blank$Nitrate_input))
df_aero_blank %&lt;&gt;% mutate(Correction_factor = (Nitrate_input / Ave_NO3_mM)) 

(t_aero_blank &lt;- pivot_wider(df_aero_blank, id_cols=Nitrate_input ,names_from = Time_point, values_from = Correction_factor))</code></pre>
<pre><code># A tibble: 4 x 6
  Nitrate_input      T0      T1      T2      T3      T4
          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1          0    NaN     NaN     NaN     NaN     NaN    
2          1.25   0.876   0.862   0.898   0.838   0.784
3          2.5    0.898   0.899   0.906   0.869   0.835
4          5      0.909   0.870   0.862   0.837   0.749</code></pre>
<pre class="r"><code>t_aero_blank &lt;- tibble::column_to_rownames(t_aero_blank, var=&quot;Nitrate_input&quot;)

is.nan.data.frame &lt;- function(x) do.call(cbind, lapply(x, is.nan))
t_aero_blank[is.nan(t_aero_blank)] &lt;- 1

cat = &quot;Aerobic&quot;
df_aerobic_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Sample_type == &quot;Soil&quot;, Category == cat)

(t_aero_Ave &lt;- pivot_wider(df_aerobic_mcf, id_cols=Nitrate_input ,names_from = Time_point, values_from = Ave_NO3_mM))</code></pre>
<pre><code># A tibble: 4 x 6
  Nitrate_input    T0    T1       T2      T3     T4
          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1          0     0     0    0.000621 0.00767 0.0104
2          1.25  1.25  1.18 1.24     1.19    0.969 
3          2.5   2.46  2.30 2.32     2.24    2.17  
4          5     4.86  4.72 4.54     4.62    4.57  </code></pre>
<pre class="r"><code>(t_aero_Ave &lt;- tibble::column_to_rownames(t_aero_Ave, var=&quot;Nitrate_input&quot;))</code></pre>
<pre><code>           T0       T1           T2          T3         T4
0    0.000000 0.000000 0.0006210829 0.007667879 0.01043146
1.25 1.250175 1.178651 1.2400388210 1.194987670 0.96939696
2.5  2.463373 2.303981 2.3248610740 2.244298701 2.16742978
5    4.862543 4.715858 4.5417551205 4.617570256 4.56602511</code></pre>
<pre class="r"><code>(t_aero_Std &lt;- pivot_wider(df_aerobic_mcf, id_cols=Nitrate_input ,names_from = Time_point, values_from = Std_NO3_mM))</code></pre>
<pre><code># A tibble: 4 x 6
  Nitrate_input     T0     T1      T2     T3     T4
          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1          0    0      0      0.00124 0.0153 0.0209
2          1.25 0.0421 0.0422 0.00278 0.0259 0.648 
3          2.5  0.0481 0.0865 0.126   0.0976 0.768 
4          5    0.0727 0.136  0.205   0.0682 0.890 </code></pre>
<pre class="r"><code>(t_aero_Std &lt;- tibble::column_to_rownames(t_aero_Std, var=&quot;Nitrate_input&quot;))</code></pre>
<pre><code>             T0         T1          T2         T3         T4
0    0.00000000 0.00000000 0.001242166 0.01533576 0.02086293
1.25 0.04206212 0.04224305 0.002783285 0.02594864 0.64789393
2.5  0.04806932 0.08650185 0.125571655 0.09762936 0.76811957
5    0.07273176 0.13569937 0.204774114 0.06816347 0.88971465</code></pre>
<pre class="r"><code>class(t_aero_Ave)</code></pre>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<pre class="r"><code># corrected
t_aero_Ave_c &lt;- t_aero_Ave * t_aero_blank
t_aero_Std_c &lt;- t_aero_Std * t_aero_blank

# row names to column
t_aero_Ave_c &lt;- tibble::rownames_to_column(t_aero_Ave_c, var=&quot;Nitrate_input&quot;)
t_aero_Std_c &lt;- tibble::rownames_to_column(t_aero_Std_c, var=&quot;Nitrate_input&quot;)

# to dataframe
df_aero_Ave_c &lt;- pivot_longer(t_aero_Ave_c, cols=-1, names_to = &quot;Time_point&quot;, values_to = &quot;Ave_NO3_mM&quot;)
df_aero_Std_c &lt;- pivot_longer(t_aero_Std_c, cols=-1, names_to = &quot;Time_point&quot;, values_to = &quot;Std_NO3_mM&quot;)

# set all nitrate_input to numeric
df_aerobic_mcf$Nitrate_input &lt;- as.numeric(as.character(df_aerobic_mcf$Nitrate_input))
df_aero_Ave_c$Nitrate_input &lt;- as.numeric(as.character(df_aero_Ave_c$Nitrate_input))
df_aero_Std_c$Nitrate_input &lt;- as.numeric(as.character(df_aero_Std_c$Nitrate_input))

# join
df_aerobic_bcf &lt;- df_aerobic_mcf %&gt;% select(-Ave_NO2_mM, -Ave_NO3_mM, -Std_NO2_mM, -Std_NO3_mM) %&gt;% left_join(df_aero_Ave_c, by=c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;,&quot;Time_point&quot;=&quot;Time_point&quot;)) %&gt;% left_join(df_aero_Std_c, by=c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;,&quot;Time_point&quot;=&quot;Time_point&quot;)) 



# For anaerobic
df_anae_blank &lt;- df_anae_b
df_anae_blank$Nitrate_input &lt;- as.numeric(as.character(df_anae_blank$Nitrate_input))
df_anae_blank %&lt;&gt;% mutate(Correction_factor = (Nitrate_input / Ave_NO3_mM)) 

(t_anae_blank &lt;- pivot_wider(df_anae_blank, id_cols=Nitrate_input ,names_from = Time_point, values_from = Correction_factor))</code></pre>
<pre><code># A tibble: 4 x 6
  Nitrate_input      T0      T1      T2      T3      T4
          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1          0    NaN     NaN     NaN     NaN     NaN    
2          1.25   0.876   0.839   0.849   0.812   0.781
3          2.5    0.898   0.882   0.867   0.858   0.802
4          5      0.909   0.845   0.847   0.834   0.759</code></pre>
<pre class="r"><code>t_anae_blank &lt;- tibble::column_to_rownames(t_anae_blank, var=&quot;Nitrate_input&quot;)
t_anae_blank[is.nan(t_anae_blank)] &lt;- 1

(t_anae_Ave &lt;- pivot_wider(df_anaerobic_mcf, id_cols=Nitrate_input ,names_from = Time_point, values_from = Ave_NO3_mM))</code></pre>
<pre><code># A tibble: 4 x 2
  Nitrate_input    T0
          &lt;dbl&gt; &lt;dbl&gt;
1          0     0   
2          1.25  1.25
3          2.5   2.46
4          5     4.86</code></pre>
<pre class="r"><code>t_anae_Ave &lt;- tibble::column_to_rownames(t_anae_Ave, var=&quot;Nitrate_input&quot;)

(t_anae_Std &lt;- pivot_wider(df_anaerobic_mcf, id_cols=Nitrate_input ,names_from = Time_point, values_from = Std_NO3_mM))</code></pre>
<pre><code># A tibble: 4 x 2
  Nitrate_input     T0
          &lt;dbl&gt;  &lt;dbl&gt;
1          0    0     
2          1.25 0.0421
3          2.5  0.0481
4          5    0.0727</code></pre>
<pre class="r"><code>t_anae_Std &lt;- tibble::column_to_rownames(t_anae_Std, var=&quot;Nitrate_input&quot;)

class(t_anae_Ave)</code></pre>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<pre class="r"><code># corrected
t_anae_Ave_c &lt;- t_anae_Ave * t_anae_blank</code></pre>
<pre><code>Error in Ops.data.frame(t_anae_Ave, t_anae_blank): &#39;*&#39; only defined for equally-sized data frames</code></pre>
<pre class="r"><code>t_anae_Std_c &lt;- t_anae_Std * t_anae_blank</code></pre>
<pre><code>Error in Ops.data.frame(t_anae_Std, t_anae_blank): &#39;*&#39; only defined for equally-sized data frames</code></pre>
<pre class="r"><code># row names to column
t_anae_Ave_c &lt;- tibble::rownames_to_column(t_anae_Ave_c, var=&quot;Nitrate_input&quot;)</code></pre>
<pre><code>Error in tibble::rownames_to_column(t_anae_Ave_c, var = &quot;Nitrate_input&quot;): object &#39;t_anae_Ave_c&#39; not found</code></pre>
<pre class="r"><code>t_anae_Std_c &lt;- tibble::rownames_to_column(t_anae_Std_c, var=&quot;Nitrate_input&quot;)</code></pre>
<pre><code>Error in tibble::rownames_to_column(t_anae_Std_c, var = &quot;Nitrate_input&quot;): object &#39;t_anae_Std_c&#39; not found</code></pre>
<pre class="r"><code># to dataframe
df_anae_Ave_c &lt;- pivot_longer(t_anae_Ave_c, cols=-1, names_to = &quot;Time_point&quot;, values_to = &quot;Ave_NO3_mM&quot;)</code></pre>
<pre><code>Error in pivot_longer(t_anae_Ave_c, cols = -1, names_to = &quot;Time_point&quot;, : object &#39;t_anae_Ave_c&#39; not found</code></pre>
<pre class="r"><code>df_anae_Std_c &lt;- pivot_longer(t_anae_Std_c, cols=-1, names_to = &quot;Time_point&quot;, values_to = &quot;Std_NO3_mM&quot;)</code></pre>
<pre><code>Error in pivot_longer(t_anae_Std_c, cols = -1, names_to = &quot;Time_point&quot;, : object &#39;t_anae_Std_c&#39; not found</code></pre>
<pre class="r"><code># create a function

multiply_blank_correction &lt;- function(df_aero_b, mcf_file){
  # Blank reads
  df_aero_blank &lt;- df_aero_b
  df_aero_blank$Nitrate_input &lt;- as.numeric(as.character(df_aero_blank$Nitrate_input))
  df_aero_blank %&lt;&gt;% mutate(Correction_factor = (Nitrate_input / Ave_NO3_mM)) 
  
  (t_aero_blank &lt;- pivot_wider(df_aero_blank, id_cols=Nitrate_input ,names_from = Time_point, values_from = Correction_factor))
  t_aero_blank &lt;- tibble::column_to_rownames(t_aero_blank, var=&quot;Nitrate_input&quot;)
  t_aero_blank[is.nan(t_aero_blank)] &lt;- 1
  
  (t_aero_Ave &lt;- pivot_wider(mcf_file, id_cols=Nitrate_input ,names_from = Time_point, values_from = Ave_NO3_mM))
  t_aero_Ave &lt;- tibble::column_to_rownames(t_aero_Ave, var=&quot;Nitrate_input&quot;)
  
  (t_aero_Std &lt;- pivot_wider(mcf_file, id_cols=Nitrate_input ,names_from = Time_point, values_from = Std_NO3_mM))
  t_aero_Std &lt;- tibble::column_to_rownames(t_aero_Std, var=&quot;Nitrate_input&quot;)
  
  class(t_aero_Ave)
  
  # corrected
  t_aero_Ave_c &lt;- t_aero_Ave * t_aero_blank
  t_aero_Std_c &lt;- t_aero_Std * t_aero_blank
  
  # row names to column
  t_aero_Ave_c &lt;- tibble::rownames_to_column(t_aero_Ave_c, var=&quot;Nitrate_input&quot;)
  t_aero_Std_c &lt;- tibble::rownames_to_column(t_aero_Std_c, var=&quot;Nitrate_input&quot;)
  
  # to dataframe
  df_aero_Ave_c &lt;- pivot_longer(t_aero_Ave_c, cols=-1, names_to = &quot;Time_point&quot;, values_to = &quot;Ave_NO3_mM&quot;)
  df_aero_Std_c &lt;- pivot_longer(t_aero_Std_c, cols=-1, names_to = &quot;Time_point&quot;, values_to = &quot;Std_NO3_mM&quot;)
  
  # set all nitrate_input to numeric
  mcf_file$Nitrate_input &lt;- as.numeric(as.character(mcf_file$Nitrate_input))
  df_aero_Ave_c$Nitrate_input &lt;- as.numeric(as.character(df_aero_Ave_c$Nitrate_input))
  df_aero_Std_c$Nitrate_input &lt;- as.numeric(as.character(df_aero_Std_c$Nitrate_input))
  
  # join
  df_aerobic_bcf &lt;- mcf_file %&gt;% select(-Ave_NO2_mM, -Ave_NO3_mM, -Std_NO2_mM, -Std_NO3_mM) %&gt;% left_join(df_aero_Ave_c, by=c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;,&quot;Time_point&quot;=&quot;Time_point&quot;)) %&gt;% left_join(df_aero_Std_c, by=c(&quot;Nitrate_input&quot;=&quot;Nitrate_input&quot;,&quot;Time_point&quot;=&quot;Time_point&quot;)) 
  
  return(df_aerobic_bcf)
}

# make df_anaerobic_mcf
df_anaerobic_mcf &lt;- df_NO2NO3_mcf %&gt;% filter(Sample_type == &quot;Soil&quot;, Category == &quot;Anaerobic&quot;)
df_anaerobic_mcf_T0 &lt;- df_NO2NO3_mcf %&gt;% filter(Category==&quot;Aerobic&quot;, Time_point==&quot;T0&quot;, Plate==&quot;P1&quot;, Sample_type==&quot;Soil&quot;)
df_anaerobic_mcf &lt;- rbind(df_anaerobic_mcf_T0, df_anaerobic_mcf)


df_anaerobic_bcf &lt;- multiply_blank_correction(df_anae_b, df_anaerobic_mcf)

df_aerobic_bcf &lt;- multiply_blank_correction(df_aero_b, df_aerobic_mcf)

# 1. Anaerobic Nitrate dynamics
df_anaerobic_bcf$Nitrate_input &lt;- factor(df_anaerobic_bcf$Nitrate_input)

ggplot(df_anaerobic_bcf, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;(After blank correction method2) Anaerobic NO3 dynamic - No carbon added (potential contamination in T1) \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-11-1.png" width="1056" style="display: block; margin: auto;" /></p>
<pre class="r"><code># 2. Aerobic Nitrate dynamics
df_aerobic_bcf$Nitrate_input &lt;- factor(df_aerobic_bcf$Nitrate_input)

ggplot(df_aerobic_bcf, aes(x=Time_hours, y=Ave_NO3_mM, color=Nitrate_input, group=Nitrate_input )) +
  geom_point(size=2.5, shape=21) +
  geom_line(size=1)+
  geom_errorbar(aes(ymin=Ave_NO3_mM - Std_NO3_mM, ymax=Ave_NO3_mM + Std_NO3_mM), width=.05)+
  scale_fill_brewer(palette=&#39;Set2&#39;) +
  ylab(&quot;NO3- (mM) \n&quot;) +
  xlab(&quot;\n Time point (hr)&quot;) +
  # scale_y_continuous(breaks = seq(0,0.3,0.05), limits=c(0, 0.3))+
  ggtitle(&quot;(After blank correction method2) Aerobic NO3 dynamic - No carbon added \n&quot;) +
  # label
  geom_text(aes(label = round(Ave_NO3_mM,3)), size = 3, vjust = -1.5, family=&quot;serif&quot;, show.legend = FALSE)+
  mytheme_2d</code></pre>
<p><img src="figure/211028_Griess_time_series_trial2.Rmd/unnamed-chunk-11-2.png" width="1056" style="display: block; margin: auto;" /></p>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.0.3 (2020-10-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19042)

Matrix products: default

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggpubr_0.4.0       ggrepel_0.9.1      ape_5.5            openxlsx_4.2.3    
 [5] devtools_2.4.0     usethis_2.0.1      gtools_3.8.2       reshape2_1.4.4    
 [9] readxl_1.3.1       magrittr_2.0.1     forcats_0.5.1      stringr_1.4.0     
[13] purrr_0.3.4        readr_1.4.0        tidyr_1.1.3        tibble_3.0.4      
[17] tidyverse_1.3.1    vegan_2.5-7        lattice_0.20-41    permute_0.9-5     
[21] RColorBrewer_1.1-2 ggplot2_3.3.5      dplyr_1.0.5        workflowr_1.6.2   

loaded via a namespace (and not attached):
 [1] colorspace_2.0-0  ggsignif_0.6.2    ellipsis_0.3.2    rio_0.5.27       
 [5] rprojroot_2.0.2   fs_1.5.0          rstudioapi_0.13   farver_2.1.0     
 [9] remotes_2.4.0     fansi_0.4.2       lubridate_1.7.10  xml2_1.3.2       
[13] splines_4.0.3     cachem_1.0.4      knitr_1.33        pkgload_1.2.1    
[17] jsonlite_1.7.2    broom_0.7.9       cluster_2.1.0     dbplyr_2.1.1     
[21] compiler_4.0.3    httr_1.4.2        backports_1.2.1   assertthat_0.2.1 
[25] Matrix_1.2-18     fastmap_1.1.0     cli_3.0.1         later_1.2.0      
[29] htmltools_0.5.1.1 prettyunits_1.1.1 tools_4.0.3       gtable_0.3.0     
[33] glue_1.4.2        Rcpp_1.0.5        carData_3.0-4     cellranger_1.1.0 
[37] jquerylib_0.1.4   vctrs_0.3.8       nlme_3.1-149      xfun_0.22        
[41] ps_1.6.0          testthat_3.0.2    rvest_1.0.1       lifecycle_1.0.0  
[45] rstatix_0.7.0     MASS_7.3-53       scales_1.1.1      hms_1.1.0        
[49] promises_1.2.0.1  parallel_4.0.3    yaml_2.2.1        curl_4.3.2       
[53] memoise_2.0.0     sass_0.4.0        stringi_1.5.3     highr_0.9        
[57] desc_1.3.0        pkgbuild_1.2.0    zip_2.1.1         rlang_0.4.10     
[61] pkgconfig_2.0.3   evaluate_0.14     labeling_0.4.2    tidyselect_1.1.1 
[65] processx_3.5.1    plyr_1.8.6        R6_2.5.0          generics_0.1.0   
[69] DBI_1.1.1         pillar_1.6.0      haven_2.4.1       whisker_0.4      
[73] foreign_0.8-80    withr_2.4.2       mgcv_1.8-33       abind_1.4-5      
[77] modelr_0.1.8      crayon_1.4.1      car_3.0-11        utf8_1.1.4       
[81] rmarkdown_2.9     grid_4.0.3        data.table_1.14.0 callr_3.7.0      
[85] git2r_0.28.0      reprex_2.0.0      digest_0.6.27     httpuv_1.6.0     
[89] munsell_0.5.0     bslib_0.2.5.1     sessioninfo_1.1.1</code></pre>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
